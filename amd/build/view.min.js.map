{"version":3,"sources":["../src/view.js"],"names":["define","$","JUI","STR","HTML","VIEW","plugin","playercontainer","progresscontainer","searchcontainer","searchpage","searchsize","searchterm","searchlevel","str","get_strings","done","s","i","addthisvideo","advanced","beginner","confirmremovevideo","copyright","description","duration","error","goals","hideadvanced","intermediate","level","ok","search","showadvanced","topics","transcript","videosearch","videosearchhelp","videosearchprompt","init","opts","getoptions","Deferred","ajax","viewajaxurl","cmid","moodlesesskey","resolve","ECSDK","when","sdkmode","sdkurl","sdkversion","url","dataType","cache","window","click","evt","play_video","stopPropagation","preventDefault","sortable","ui","item","find","data","get_videoid_from_url","index","html","droppable","confirm","draggable","remove","submit","clear_player_and_searchresults","term","val","map","value","get","join","match","fetch_videos","search_videos","text","toggle","elm","ecsdk","setHandler","setOnProgressEventHandler","setOnModeEndHandler","eventType","thumbframe","dialogID","length","sdktoken","replace","JSON","parse","toString","substr","dialog","addClass","href","location","indexOf","replaceWith","thumb","after","dialogId","get_videoid","options","consumerkey","lang","sitelanguage","siteLanguage","autoStart","activityPanelEnabled","interstitialsEnabled","learnMode","speakMode","quizMode","width","w","outerWidth","offset","left","height","loadWidget","page","size","ids","set_search_params","siteanguage","fetchurl","accept1","authorization","dialogs","info","count","results","highlights","en_name","title","en_topic","name","en_description","push","score","format_results","difficulty","searchurl","isNotNum","parseInt","pagingbar","videoids","get_videoids","id","format_result","get_string","formatnumber","prepend","tag","v","dialogURL","thumbnailURL","add_video","siblings","open_window","closest","prop","videoinfourl","get_videoid_from_id","each","Math","min","innerWidth","h","innerHeight","x","screenX","y","outerHeight","screenY","win","open","targetwindow","focus","lastpage","ceil","p_min","max","p_max","p","n","separator","insertBefore","fadeTo","slideUp","r","format_add","format_thumb","format_info","src","emptytag","starttag","endtag","img","format_details","format_goalstopics","format_description","format_transcript","format_copyright","format_detail","txt","type"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the term of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * load the EnglishCentral player\n *\n * @module      mod_englishcentral/view\n * @category    output\n * @copyright   Gordon Bateson\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       2.9\n */\ndefine([\"jquery\", \"jqueryui\", \"core/str\", \"mod_englishcentral/html\"], function($, JUI, STR, HTML) {\n\n    /** @alias module:mod_englishcentral/view */\n    var VIEW = {};\n\n    // cache full plugin name\n    VIEW.plugin = \"mod_englishcentral\";\n\n    // define DOM element names\n    VIEW.playercontainer   = \"id_playercontainer\";\n    VIEW.progresscontainer = \"id_progresscontainer\";\n    VIEW.searchcontainer   = \"id_searchcontainer\";\n\n    // initialize search params\n    VIEW.searchpage = 0;\n    VIEW.searchsize = 20;\n    VIEW.searchterm = \"\";\n    VIEW.searchlevel = \"\";\n\n    // initialize string cache\n    VIEW.str = {};\n\n    // set up strings\n    STR.get_strings([\n        {\"key\": \"addthisvideo\",       \"component\": VIEW.plugin},\n        {\"key\": \"advanced\",           \"component\": VIEW.plugin},\n        {\"key\": \"beginner\",           \"component\": VIEW.plugin},\n        {\"key\": \"confirmremovevideo\", \"component\": VIEW.plugin},\n        {\"key\": \"copyright\",          \"component\": VIEW.plugin},\n        {\"key\": \"description\",        \"component\": VIEW.plugin},\n        {\"key\": \"duration\",           \"component\": \"search\"},\n        {\"key\": \"error\",              \"component\": \"error\"},\n        {\"key\": \"goals\",              \"component\": VIEW.plugin},\n        {\"key\": \"hideadvanced\",       \"component\": \"form\"},\n        {\"key\": \"intermediate\",       \"component\": VIEW.plugin},\n        {\"key\": \"level\",              \"component\": VIEW.plugin},\n        {\"key\": \"ok\",                 \"component\": \"moodle\"},\n        {\"key\": \"search\",             \"component\": \"moodle\"},\n        {\"key\": \"showadvanced\",       \"component\": \"form\"},\n        {\"key\": \"topics\",             \"component\": VIEW.plugin},\n        {\"key\": \"transcript\",         \"component\": VIEW.plugin},\n        {\"key\": \"videosearch\",        \"component\": VIEW.plugin},\n        {\"key\": \"videosearchhelp\",    \"component\": VIEW.plugin},\n        {\"key\": \"videosearchprompt\",  \"component\": VIEW.plugin}\n    ]).done(function(s) {\n        var i = 0;\n        VIEW.str.addthisvideo = s[i++];\n        VIEW.str.advanced = s[i++];\n        VIEW.str.beginner = s[i++];\n        VIEW.str.confirmremovevideo = s[i++];\n        VIEW.str.copyright = s[i++];\n        VIEW.str.description = s[i++];\n        VIEW.str.duration = s[i++];\n        VIEW.str.error = s[i++];\n        VIEW.str.goals = s[i++];\n        VIEW.str.hideadvanced = s[i++];\n        VIEW.str.intermediate = s[i++];\n        VIEW.str.level = s[i++];\n        VIEW.str.ok = s[i++];\n        VIEW.str.search = s[i++];\n        VIEW.str.showadvanced = s[i++];\n        VIEW.str.topics = s[i++];\n        VIEW.str.transcript = s[i++];\n        VIEW.str.videosearch = s[i++];\n        VIEW.str.videosearchhelp = s[i++];\n        VIEW.str.videosearchprompt = s[i++];\n    });\n\n    VIEW.init = function(opts) {\n\n        // Cache basic options received from Moodle, e.g. cmid, sesskey, ajax URL.\n        // These give us just enough information to get more options asynchronously.\n        for (var i in opts) {\n            VIEW[i] = opts[i];\n        }\n\n        // get more options asynchronously from Moodle\n        VIEW.getoptions = $.Deferred();\n        $.ajax({\n            \"url\": VIEW.viewajaxurl,\n            \"type\": \"POST\",\n            \"data\": {\"id\" : VIEW.cmid,\n                     \"action\": \"getoptions\",\n                     \"sesskey\" : VIEW.moodlesesskey},\n            \"dataType\": \"json\",\n            \"success\": function(opts){\n                for (var i in opts) {\n                    VIEW[i] = opts[i];\n                }\n                VIEW.getoptions.resolve();\n            }\n        });\n\n        // ensure ECSDK is fully loaded before it is used\n        VIEW.ECSDK = $.Deferred();\n        $.when(VIEW.getoptions).done(function(){\n            // set appropriate SDK url for specified SDK version\n            if (VIEW.sdkmode==1) {\n                // development mode\n                VIEW.sdkurl = \"https://www.qaenglishcentral.com\";\n            } else {\n                // production mode\n                VIEW.sdkurl = \"https://www.englishcentral.com\";\n            }\n            if (VIEW.sdkversion==\"JSDK2\") {\n                // JSDK2 (available until Sept 2018)\n                VIEW.sdkurl += \"/partnersdk/sdk.js\";\n            } else {\n                // JSDK3 (available from July 2017)\n                VIEW.sdkurl += \"/dist/sdk/sdk.js\";\n            }\n            $.ajax({\n                url: VIEW.sdkurl,\n                dataType: \"script\",\n                cache: true\n            }).done(function() {\n                VIEW.ECSDK.resolve(window.ECSDK);\n            });\n        });\n\n        $(\".activity-title, .thumb-frame\").click(function(evt) {\n            VIEW.play_video(evt, this);\n            evt.stopPropagation();\n            evt.preventDefault();\n            return false;\n        });\n\n        // make the video thumnails sortable\n        $(\".englishcentral_videos\").sortable({\n            \"cursor\": \"move\",\n            \"items\": \".activity-thumbnail\",\n            \"update\": function(evt, ui) {\n                var url = ui.item.find(\".activity-title\").data(\"url\");\n                var data = {\n                    \"dialogId\": VIEW.get_videoid_from_url(url),\n                    \"sortorder\": ui.item.index() + 1\n                };\n                $.ajax({\n                    \"url\": VIEW.viewajaxurl,\n                    \"type\": \"POST\",\n                    \"data\": {\n                        \"id\": VIEW.cmid,\n                        \"data\": data,\n                        \"action\": \"sortvideo\",\n                        \"sesskey\": VIEW.moodlesesskey\n                    },\n                    \"dataType\": \"html\",\n                    \"success\": function(html) {\n                        if (html) {\n                            // probably an error message\n                            $(\"#\" + VIEW.playercontainer).html(html);\n                        }\n                    }\n                });\n            }\n        });\n\n        // make the video thumnails draggable\n        //$(\".activity-thumbnail\").draggable({\n        //});\n\n        $(\".removevideo\").droppable({\n            \"drop\": function(evt, ui) {\n                if (confirm(VIEW.str.confirmremovevideo)) {\n                    ui.draggable.remove();\n                    var url = ui.draggable.find(\".activity-title\").data(\"url\");\n                    var data = {\n                        \"dialogId\": VIEW.get_videoid_from_url(url)\n                    };\n                    $.ajax({\n                        \"url\": VIEW.viewajaxurl,\n                        \"type\": \"POST\",\n                        \"data\": {\n                            \"id\": VIEW.cmid,\n                            \"data\": data,\n                            \"action\": \"removevideo\",\n                            \"sesskey\": VIEW.moodlesesskey\n                        },\n                        \"dataType\": \"html\",\n                        \"success\": function(html) {\n                            if (html) {\n                                // probably an error message\n                                $(\"#\" + VIEW.playercontainer).html(html);\n                            }\n                        }\n                    });\n                }\n            }\n        });\n\n        // override standard form submit action\n        $(\"#\" + VIEW.searchcontainer + \" .search-form\").submit(function(evt){\n\n            // remove player and previous search results\n            VIEW.clear_player_and_searchresults();\n\n            // RegExp to match a list of comma-separated values\n            var list = new RegExp(\"^\\s*[0-9]+([, \\\\t\\\\r\\\\n]+[0-9]+)*\\s*$\");\n\n            var term = $(\"#id_searchterm\").val();\n            var level = $(\"[name='level[]']:checked\").map(function() {return this.value;}).get().join(',');\n            if (term == \"\") {\n                $(\".search-results\").html(VIEW.str.videosearchhelp);\n            } else if (term.match(list)) {\n                VIEW.fetch_videos(null, null, term, level);\n            } else {\n                VIEW.search_videos(null, null, term, level);\n            }\n            evt.preventDefault();\n        });\n\n        // add event event handler to show/hide advanced settings\n        $(\"#\" + VIEW.searchcontainer + \" .search-advanced\").click(function(){\n            if ($(this).text()==VIEW.str.showadvanced) {\n                $(this).text(VIEW.str.hideadvanced);\n            } else {\n                $(this).text(VIEW.str.showadvanced);\n            }\n            $(\"#\" + VIEW.searchcontainer + \" .search-fields\").find(\"dt:not(.visible), dd:not(.visible)\").toggle();\n        });\n    };\n\n    VIEW.play_video = function(evt, elm) {\n\n        // make sure the ECSDK object is available\n        // and also pass through evt and elm\n        $.when(VIEW.ECSDK, evt, elm).done(function(ecsdk, evt, elm){\n\n            // remove player and previous search results\n            VIEW.clear_player_and_searchresults();\n\n            // set handler for end of mode\n            var setHandler = \"\";\n            if (ecsdk.setOnProgressEventHandler) {\n                setHandler = \"setOnProgressEventHandler\";\n            } else if (ecsdk.setOnModeEndHandler) {\n                setHandler = \"setOnModeEndHandler\";\n            }\n            if (setHandler) {\n                ecsdk[setHandler](function(data) {\n\n                    switch (data.eventType) {\n                        case \"CompleteActivityWatch\":\n                        case \"LearnedWord\":\n                        case \"DialogLineSpeak\":\n                            break;\n\n                        case \"DialogLineWatch\":\n                            var thumbframe = \".thumb-frame[data-url$=\" + data.dialogID + \"]\";\n                            if ($(thumbframe + \" .watch-status\").length) {\n                                return false;\n                            }\n                            break;\n\n                        case \"CompleteActivityLearn\":\n                        case \"CompleteActivitySpeak\":\n                            return false;\n\n                        case \"StartActivityWatch\":\n                        case \"StartActivityLearn\":\n                        case \"TypedWord\":\n                        case \"StudiedWord\":\n                        case \"StartActivitySpeak\":\n                            return false;\n\n                        default:\n                            // oops - an unexpected value\n                            break;\n                    }\n\n                    // AJAX call to send the data.dialogID to the Moodle server\n                    // and receive the html for the updated Progress pie-charts\n                    $.ajax({\n                        \"url\": VIEW.viewajaxurl,\n                        \"type\": \"POST\",\n                        \"data\": {\n                            \"id\": VIEW.cmid,\n                            \"data\": {\n                                \"dialogID\": data.dialogID,\n                                \"sdktoken\": VIEW.sdktoken\n                            },\n                            \"action\": \"storeresults\",\n                            \"sesskey\": VIEW.moodlesesskey\n                        },\n                        \"dataType\": \"html\"\n                    }).done(function(html){\n\n                        // Is this a PHP error reported as a JSON string?\n                        // e.g. a session timeout.\n                        if (html.match(new RegExp(\"^\\\\{.*\\\\}$\"))) {\n                            html = html.replace(new RegExp(\"\\\\n\", \"g\"), \"\\\\\\\\n\");\n                            html = JSON.parse(html);\n                            if (html.error) {\n                                html = html.error.replace(new RegExp(\"\\\\n\", \"g\"), \"<br>\");\n                            } else {\n                                html = html.toString().substr(0, 200);\n                                html = 'Sorry, there was an unknown error on the server.\\n' + html;\n                            }\n\n                            if (VIEW.dialog) {\n                                if (VIEW.dialog.dialog(\"isOpen\")) {\n                                    VIEW.dialog.dialog(\"close\");\n                                }\n                            } else {\n                                VIEW.dialog = $(\"<div></div>\").addClass(\"dialog\");\n                                VIEW.dialog.dialog({\"autoOpen\": false});\n                            }\n                            VIEW.dialog.html(html);\n\n                            VIEW.dialog.dialog(\"option\", \"title\", VIEW.str.error);\n                            VIEW.dialog.dialog(\"option\", \"buttons\", [{\n                                \"text\": VIEW.str.ok,\n                                //\"icon\": \"ui-icon-check\",\n                                \"click\": function(){\n                                    $(this).dialog(\"close\");\n                                    var href = VIEW.viewajaxurl.replace(\".ajax\", \"\");\n                                    window.location.href = href + \"?id=\" + VIEW.cmid;\n                                }\n                            }]);\n                            VIEW.dialog.dialog(\"open\");\n                            return false;\n                        }\n\n                        if (html.indexOf(\"englishcentral_progress\") < 0) {\n                            // probably an error message\n                            $(\".englishcentral_progress\").html(html);\n                        } else {\n                            $(\".englishcentral_progress\").replaceWith(html);\n                        }\n\n                        // AJAX call to send the data.dialogID to the Moodle server\n                        // and receive the html for the updated status of this video\n                        $.ajax({\n                            \"url\": VIEW.viewajaxurl,\n                            \"type\": \"POST\",\n                            \"data\": {\n                                \"id\": VIEW.cmid,\n                                \"data\": {\n                                    \"dialogID\": data.dialogID,\n                                    \"sdktoken\": VIEW.sdktoken\n                                },\n                                \"action\": \"showstatus\",\n                                \"sesskey\": VIEW.moodlesesskey\n                            },\n                            \"dataType\": \"html\"\n                        }).done(function(html) {\n                            var thumb = $(\".thumb-frame[data-url$=\" + data.dialogID + \"]\");\n                            thumb.find(\".watch-status, .learn-status, .speak-status\").remove();\n                            thumb.find(\".play-icon\").after(html);\n                        });\n                    });\n                });\n            }\n\n            var dialogId = VIEW.get_videoid(elm);\n            var completed = \".thumb-frame[data-url$=\" +dialogId + \"] .watch-status.completed\";\n\n            // set player options (JSDK2 and JSDK3)\n            var options = {\n                \"partnerKey\": VIEW.consumerkey,\n                \"partnerSdkToken\": VIEW.sdktoken,\n                \"container\": VIEW.playercontainer,\n                \"dialogId\": dialogId\n            };\n\n            if (VIEW.sdkversion==\"JSDK3\") {\n                // JSDK3 (from July 2018)\n                options.lang = VIEW.sitelanguage;\n            } else {\n                // JSDK2 (until Sept 2018)\n                options.siteLanguage = VIEW.sitelanguage;\n                options.autoStart = $(completed).length;\n                options.activityPanelEnabled = false;\n                options.interstitialsEnabled = true;\n                options.learnMode = true;\n                options.speakMode = true;\n                options.quizMode = true;\n                // options.newWindow = (is_iOS ? true : false);\n                // options.goLiveMode = true;\n                options.width = 640;\n\n                // set player width and height, in order to see WLS controls\n                var w = window.outerWidth - $(\"#\" + VIEW.playercontainer).offset().left - 24;\n                if (options.width > w) {\n                    options.width = w;\n                } else if (w > 1000) {\n                    options.width = 1000;\n                } else {\n                    options.height = 655;\n                }\n            }\n\n            // initialize EC player\n            ecsdk.loadWidget(\"player\", options);\n        });\n    };\n\n    VIEW.clear_player_and_searchresults = function() {\n        $(\"#\" + VIEW.playercontainer).html(\"\");\n        $(\"#\" + VIEW.searchcontainer + \" .search-results\").html(\"\");\n    };\n\n    VIEW.fetch_videos = function(page, size, term, level) {\n        var spacer = new RegExp(\"[, \\\\t\\\\r\\\\n]+\", \"g\");\n        var ids = term.replace(spacer, \",\");\n        VIEW.set_search_params(page, size, ids, level);\n        var data = {\n            \"dialogIDs\": ids,\n            \"page\": VIEW.searchpage,\n            \"pageSize\": VIEW.searchsize,\n            \"siteLanguage\": VIEW.siteanguage\n        };\n        $.ajax({\n            \"url\": VIEW.fetchurl,\n            \"type\": \"GET\",\n            \"data\": data,\n            \"dataType\": \"json\",\n            \"headers\": {\n                \"Accept\": VIEW.accept1,\n                \"Authorization\": VIEW.authorization,\n                \"Content-Type\": \"application/json\"\n            },\n            \"success\": function(dialogs) {\n                var info = false;\n                // If we have results, format as view expects and list them up\n                if (dialogs && dialogs.length>0) {\n                    info = {count: dialogs.length, results: []};\n                    for(var i = 0; i<dialogs.length;i++){\n                        var highlights={};\n                        highlights.en_name= [\"<em>\" + dialogs[i].title +\"</em>\"];\n                        highlights.en_topic= [\"<em>\" + dialogs[i].topics[0].name +\"</em>\"];\n                        highlights.en_description=  [dialogs[i].description];\n                        info.results.push({score: 150,value: dialogs[i],highlights: highlights});\n                    }\n                }\n                VIEW.format_results(info);\n            }\n        });\n    };\n\n    VIEW.search_videos = function(page, size, term, level) {\n        VIEW.set_search_params(page, size, term, level);\n        var data = {\n            \"term\": VIEW.searchterm,\n            \"page\": VIEW.searchpage,\n            \"pageSize\": VIEW.searchsize\n        };\n        if (level) {\n            data.difficulty = level;\n        }\n        if (VIEW.searchterm) {\n            $.ajax({\n                \"url\": VIEW.searchurl,\n                \"type\": \"GET\",\n                \"data\": data,\n                \"dataType\": \"json\",\n                \"headers\": {\n                    \"Accept\": VIEW.accept1,\n                    \"Authorization\": VIEW.authorization,\n                    \"Content-Type\": \"application/json\"\n                },\n                \"success\": function(info) {\n                    VIEW.format_results(info);\n                }\n            });\n        }\n    };\n\n    VIEW.set_search_params = function(page, size, term, level) {\n        if (VIEW.isNotNum(page)) {\n            VIEW.searchpage = 0;\n            VIEW.searchterm = \"\";\n            VIEW.searchlevel = \"\";\n        } else {\n            VIEW.searchpage = parseInt(page);\n        }\n        if (size) {\n            VIEW.searchsize = parseInt(size);\n        }\n        if (term) {\n            VIEW.searchterm = term;\n        }\n        if (level) {\n            VIEW.searchlevel = level;\n        }\n    };\n\n    VIEW.format_results = function(info) {\n        var html = \"\";\n\n        // finish early if there are no results\n        if ((!info) || (!info.results) || info.results.length == 0) {\n            return html;\n        }\n\n        // cache the paging-bar (we need it twice)\n        var pagingbar = VIEW.pagingbar(info.count);\n\n        // add top paging-bar\n        html += pagingbar;\n\n        // add results\n        var videoids = VIEW.get_videoids();\n        for (var i = 0; i < info.results.length; i++) {\n            // skip videos that are already displayed\n            var id = info.results[i].value.dialogID.toString();\n            if (videoids.indexOf(id) < 0) {\n                html += VIEW.format_result(info.results[i]);\n            }\n        }\n\n        // add bottom paging-bar\n        html += pagingbar;\n\n        // populate search results\n        $(\".search-results\").html(html);\n\n        // add number of items found\n        STR.get_string(\"xitemsfound\", VIEW.plugin, VIEW.formatnumber(info.count)).done(function(s) {\n            $(\".search-results\").prepend(HTML.tag(\"div\", s, {\"class\": \"itemsfound\"}));\n        });\n\n        // add click handlers for \"+\" and thumbnail\n        for (var i = 0; i < info.results.length; i++) {\n            var v = info.results[i].value;\n            var data = {\n                \"dialogId\": v.dialogID,\n                \"title\": v.title,\n                \"duration\": v.duration,\n                \"difficulty\": v.difficulty,\n                \"dialogURL\": v.dialogURL,\n                \"thumbnailURL\": v.thumbnailURL\n            };\n            var id = \"#id_add_video_\" + data.dialogId;\n            $(id).data(data);\n            $(id).click(function(evt) {\n                VIEW.add_video(evt, this);\n            });\n            $(id).siblings(\".result-thumb\").click(function() {\n                VIEW.open_window($(this).data(\"url\"));\n            });\n            $(id).siblings(\".result-info\").find(\".icon\").click(function() {\n                var id = $(this).closest(\".result-info\").siblings(\".result-add\").prop(\"id\");\n                VIEW.open_window(VIEW.videoinfourl + \"/\" + VIEW.get_videoid_from_id(id));\n            });\n        }\n\n        // add click handlers for page numbers on paging-bar\n        $(\".pagingbar\").find(\".pagenumber:not(.currentpage)\").click(function(){\n            var page = $(this).text() - 1;\n            VIEW.search_videos(page);\n        });\n    };\n\n    VIEW.get_videoids = function() {\n        var videoids = [];\n        $(\".englishcentral_videos .activity-title\").each(function() {\n            videoids.push(VIEW.get_videoid(this));\n        });\n        return videoids;\n    };\n\n    VIEW.get_videoid = function(elm) {\n        var url = $(elm).data(\"url\");\n        return VIEW.get_videoid_from_url(url);\n    };\n\n    VIEW.get_videoid_from_url = function(url) {\n        // sample href: https://www.qaenglishcentral.com/video/28864\n        return url.replace(new RegExp(\"^.*/\"), \"\");\n    };\n\n    VIEW.get_videoid_from_id = function(id) {\n        // sample id: id_add_video_27323\n        return id.replace(new RegExp(\"^.*_\"), \"\");\n    };\n\n    VIEW.open_window = function(url) {\n        var w = Math.min(640, window.innerWidth);\n        var h = Math.min(480, window.innerHeight);\n        var x = window.outerWidth / 2 + window.screenX - (w / 2);\n        var y = window.outerHeight / 2 + window.screenY - (h / 2);\n        var options = \"width=\" + w + \",height=\" + h + \",top=\" + y + \",left=\" + x;\n        var win = window.open(url, VIEW.targetwindow, options);\n        if (win.focus) {\n            win.focus();\n        }\n    };\n\n    VIEW.pagingbar = function(count) {\n        var html = \"\";\n        if (count) {\n            var size = VIEW.searchsize;\n            var lastpage = Math.ceil(count / size) - 1;\n            if (lastpage > 0) {\n                var firstpage = 0;\n\n                var page = VIEW.searchpage;\n                var p_min = Math.max(firstpage, VIEW.searchpage - 4);\n                var p_max = Math.min(lastpage, Math.max(9, VIEW.searchpage + 4));\n\n                if (firstpage < p_min) {\n                    html += HTML.tag(\"span\", (firstpage + 1), {\"class\": \"pagenumber\"});\n                    if ((p_min - firstpage) > 1) {\n                        html += HTML.tag(\"span\", \"...\", {\"class\": \"pageseparator\"});\n                    }\n                }\n                for (var p=p_min; p<=p_max; p++) {\n                    var s = \"pagenumber\";\n                    if (p==page) {\n                        s += \" currentpage\";\n                    }\n                    html += HTML.tag(\"span\", (p+1), {\"class\": s});\n                }\n                if (p_max < lastpage) {\n                    if ((lastpage - p_max) > 1) {\n                        html += HTML.tag(\"span\", \"...\", {\"class\": \"pageseparator\"});\n                    }\n                    html += HTML.tag(\"span\", (lastpage + 1), {\"class\": \"pagenumber\"});\n                }\n            }\n        }\n        if (html) {\n            html = HTML.tag(\"div\", html, {\"class\": \"pagingbar\"});\n        }\n        return html;\n    };\n\n    VIEW.formatnumber = function(n, separator) {\n        if (typeof(separator)==\"undefined\") {\n            separator = \",\";\n        }\n        if (typeof(n)==\"number\") {\n            n = n.toString();\n        }\n        // \"B\" metachar means \"not at beginning or end of word\"\n        var regexp = new RegExp(\"\\\\B(?=(\\\\d{3})+(?!\\\\d))\", \"g\");\n        return n.replace(regexp, separator);\n    };\n\n    VIEW.add_video = function(evt, elm) {\n        $.ajax({\n            \"url\": VIEW.viewajaxurl,\n            \"type\": \"POST\",\n            \"data\": {\n                \"id\": VIEW.cmid,\n                \"data\": $(elm).data(),\n                \"action\": \"addvideo\",\n                \"sesskey\": VIEW.moodlesesskey\n            },\n            \"dataType\": \"html\",\n            \"success\": function(html) {\n                $(html).insertBefore(\".removevideo\").find(\".thumb-frame\").click(function(evt) {\n                    VIEW.play_video(evt, this);\n                    evt.stopPropagation();\n                    evt.preventDefault();\n                    return false;\n                });\n            }\n        });\n\n        // remove this \"result-item\" from \"search-results\"\n        $(elm).closest(\".result-item\").fadeTo(1000, 0.01, function() {\n            $(this).slideUp(150, function() {\n                $(this).remove();\n            });\n        });\n        // https://stackoverflow.com/questions/1807187/how-to-remove-an-element-slowly-with-jquery\n    };\n\n    //\"dialogID\": 11875,\n    //\"title\": \"The Japanese Are Very Important\",\n    //\"description\": \"A global economy analyst discusses globalization and its influence on countries like Japan.\",\n    //\"difficulty\": 4,\n    //\"duration\": \"00:02:07\",\n    //\"dateModified\": \"2017-08-03T11:20:30.000Z\",\n    //\"dateFirstPublished\": \"2011-05-12T17:04:26.000Z\",\n    //\"popularityWeight\": 1.76737,\n    //\"slowSpeakAudioURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/slowspeakaudio_11875_84768.mp3\",\n    //\"dialogURL\": \"https://www.qaenglishcentral.com/video/11875\",\n    //\"thumbnailURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/thumb_11875_20160719065106.jpg\",\n    //\"featurePictureURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/featureddialog_11875_20160719065115.jpg\",\n    //\"demoPictureURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/demopicture_11875_20160719065122.jpg\",\n    //\"videoDetailsURL\": \"https://www.qaenglishcentral.com/videodetails/11875\",\n    //\"seriesThumbnailURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/dialogseriesthumbnail_11875_20160719065111.jpg\",\n    //\"dialogM4aAudioURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/audio_11875_20130527081953.m4a\",\n    //\"smallVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videomobile_11875_20140205180008.mp4\",\n    //\"mediumVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videoslowconn_11875_20131130050102.mp4\",\n    //\"largeVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videoh264_11875_20130527081953.mp4\",\n    //\"promotionalDialog\": false,\n\n    VIEW.format_result = function(r) {\n        if (VIEW.isNotNum(r.value.difficulty) || r.value.difficulty < 1 || r.value.difficulty > 7) {\n            r.value.difficulty = 0;\n            r.difficulty = \"unknown\";\n        } else {\n            switch (true) {\n                case (r.value.difficulty <= 2): r.difficulty = \"beginner\";     break;\n                case (r.value.difficulty <= 4): r.difficulty = \"intermediate\"; break;\n                case (r.value.difficulty <= 7): r.difficulty = \"advanced\";     break;\n            }\n        }\n        var html = \"\";\n        html += VIEW.format_add(r);\n        html += VIEW.format_thumb(r);\n        html += VIEW.format_info(r);\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-item\"\n        });\n    };\n\n    VIEW.format_add = function(r) {\n        var src = $(\".removevideo img\").prop(\"src\").replace(\"removevideo\", \"add\");\n        var html = HTML.emptytag(\"img\", {\n            \"src\": src,\n            \"title\": VIEW.str.addthisvideo\n        });\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-add\",\n            \"id\": \"id_add_video_\" + r.value.dialogID\n        });\n    };\n\n    VIEW.format_thumb = function(r) {\n        var duration = r.value.duration.replace(new RegExp(\"^00:\"), \"\");\n        var html = \"\";\n        html += HTML.starttag(\"div\", {\n            \"class\": \"thumb-frame\",\n            \"style\": \"background-image: url('\" + r.value.thumbnailURL + \"')\"\n        });\n        html += HTML.tag(\"div\", r.value.difficulty, {\n            \"class\": \"result-difficulty \" + r.difficulty\n        });\n        html += HTML.tag(\"div\", duration, {\n            \"class\": \"result-duration\"\n        });\n        html += HTML.endtag(\"div\");\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-thumb\",\n            \"data-url\": r.value.dialogURL,\n        });\n    };\n\n    VIEW.format_info = function(r) {\n        var html = \"\";\n        var src = $(\".removevideo img\").prop(\"src\")\n            .replace(\"removevideo\", \"i/info\")\n            .replace(\"mod_englishcentral\", \"core\");\n        var img = HTML.emptytag(\"img\", {\n            \"src\": src,\n            \"class\": \"icon\"\n        });\n        var title = r.value.title;\n        if (r.highlights.en_name) {\n            title = r.highlights.en_name[0];\n        }\n        html += HTML.tag(\"h2\", title + img, {\n            \"class\": \"result-title\"\n        });\n        html += VIEW.format_details(r);\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-info\"\n        });\n    };\n\n    VIEW.format_details = function(r) {\n        var html = \"\";\n        //html += VIEW.format_copyright(r.value.copyright);\n        html += VIEW.format_goalstopics(r.value.goals, r.value.topics, r.difficulty);\n        html += VIEW.format_description(r.value.description);\n        html += VIEW.format_transcript(r.highlights.transcript);\n        return HTML.tag(\"dl\", html, {\n            \"class\": \"result-details\"\n        });\n    };\n\n    VIEW.format_copyright = function(copyright) {\n        if (copyright && copyright.length) {\n            return VIEW.format_detail(\"copyright\", copyright);\n        }\n        return \"\";\n    };\n\n    VIEW.format_goalstopics = function(goals, topics, difficulty) {\n        var txt = [];\n        if (goals && goals.length) {\n            for (var i = 0; i < goals.length; i++) {\n                txt.push(goals[i].title);\n            }\n        }\n        if (topics && topics.length) {\n            for (var i = 0; i < topics.length; i++) {\n                txt.push(topics[i].name);\n            }\n        }\n        if (txt.length == 0) {\n            return \"\";\n        }\n        txt = txt.join(\", \");\n        txt += HTML.tag(\"span\", VIEW.str[difficulty], {\n            \"class\": \"result-level \" + difficulty\n        });\n        return VIEW.format_detail(\"topics\", txt);\n    };\n\n    VIEW.format_description = function(description) {\n        if (description && description.length) {\n            return VIEW.format_detail(\"description\", description);\n        }\n        return \"\";\n    };\n\n    VIEW.format_transcript = function(transcript) {\n        if (transcript && transcript.length) {\n            var dots = \"...\";\n            var slashes = new RegExp(\"//\", \"g\");\n            return VIEW.format_detail(\"transcript\", dots + transcript[0].replace(slashes, dots) + dots);\n        }\n        return \"\";\n    };\n\n    VIEW.format_detail = function(type, value) {\n        var html = \"\";\n        html += HTML.tag(\"dt\", VIEW.str[type], {\n            \"class\": \"result-label \" + type\n        });\n        html += HTML.tag(\"dd\", value, {\n            \"class\": \"result-value \" + type\n        });\n        return html;\n    };\n\n    VIEW.isNotNum = function(n) {\n        switch (typeof(n)) {\n            case \"number\": return false;\n            case \"string\": return (! n.match(new RegExp(\"^[0-9]+$\")));\n            default:       return true; // everything else is NOT a number\n        }\n    };\n\n    return VIEW;\n});\n"],"file":"view.min.js"}