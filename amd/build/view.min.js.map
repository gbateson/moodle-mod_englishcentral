{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-console */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the term of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * load the EnglishCentral player\n *\n * @module      mod_englishcentral/view\n * @category    output\n * @copyright   Gordon Bateson\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       2.9\n */\ndefine([\"jquery\", \"js/jquery-ui.js\", \"core/log\", \"core/str\", \"mod_englishcentral/html\"], function ($, JUI, LOG, STR, HTML) {\n\n    /** @alias module:mod_englishcentral/view */\n    var VIEW = {};\n\n    // Cache full plugin name\n    VIEW.plugin = \"mod_englishcentral\";\n\n    // Define DOM element names\n    VIEW.playercontainer = \"id_playercontainer\";\n    VIEW.progresscontainer = \"id_progresscontainer\";\n    VIEW.searchcontainer = \"id_searchcontainer\";\n\n    // Initialize search params\n    VIEW.searchpage = 0;\n    VIEW.searchsize = 20;\n    VIEW.searchterm = \"\";\n    VIEW.searchlevel = \"\";\n\n    // Initialize string cache\n    VIEW.str = {};\n\n    // Set up strings\n    STR.get_strings([\n        { \"key\": \"addthisvideo\", \"component\": VIEW.plugin },\n        { \"key\": \"advanced\", \"component\": VIEW.plugin },\n        { \"key\": \"beginner\", \"component\": VIEW.plugin },\n        { \"key\": \"confirmremovevideo\", \"component\": VIEW.plugin },\n        { \"key\": \"copyright\", \"component\": VIEW.plugin },\n        { \"key\": \"description\", \"component\": VIEW.plugin },\n        { \"key\": \"duration\", \"component\": \"search\" },\n        { \"key\": \"error\", \"component\": \"error\" },\n        { \"key\": \"goals\", \"component\": VIEW.plugin },\n        { \"key\": \"hideadvanced\", \"component\": \"form\" },\n        { \"key\": \"info\", \"component\": \"moodle\" },\n        { \"key\": \"intermediate\", \"component\": VIEW.plugin },\n        { \"key\": \"level\", \"component\": VIEW.plugin },\n        { \"key\": \"noitemsfound\", \"component\": VIEW.plugin },\n        { \"key\": \"ok\", \"component\": \"moodle\" },\n        { \"key\": \"search\", \"component\": \"moodle\" },\n        { \"key\": \"showadvanced\", \"component\": \"form\" },\n        { \"key\": \"topics\", \"component\": VIEW.plugin },\n        { \"key\": \"transcript\", \"component\": VIEW.plugin },\n        { \"key\": \"videosearch\", \"component\": VIEW.plugin },\n        { \"key\": \"videosearchhelp\", \"component\": VIEW.plugin },\n        { \"key\": \"videosearchprompt\", \"component\": VIEW.plugin },\n        { \"key\": \"videodetails\", \"component\": VIEW.plugin }\n    ]).done(function (s) {\n        var i = 0;\n        VIEW.str.addthisvideo = s[i++];\n        VIEW.str.advanced = s[i++];\n        VIEW.str.beginner = s[i++];\n        VIEW.str.confirmremovevideo = s[i++];\n        VIEW.str.copyright = s[i++];\n        VIEW.str.description = s[i++];\n        VIEW.str.duration = s[i++];\n        VIEW.str.error = s[i++];\n        VIEW.str.goals = s[i++];\n        VIEW.str.hideadvanced = s[i++];\n        VIEW.str.info = s[i++];\n        VIEW.str.intermediate = s[i++];\n        VIEW.str.level = s[i++];\n        VIEW.str.noitemsfound = s[i++];\n        VIEW.str.ok = s[i++];\n        VIEW.str.search = s[i++];\n        VIEW.str.showadvanced = s[i++];\n        VIEW.str.topics = s[i++];\n        VIEW.str.transcript = s[i++];\n        VIEW.str.videosearch = s[i++];\n        VIEW.str.videosearchhelp = s[i++];\n        VIEW.str.videosearchprompt = s[i++];\n        VIEW.str.videodetails = s[i++];\n    });\n\n    VIEW.init = function (opts) {\n\n        // Cache basic options received from Moodle, e.g. cmid, sesskey, ajax URL.\n        // These give us just enough information to get more options asynchronously.\n        for (var i in opts) {\n            VIEW[i] = opts[i];\n        }\n\n        // Get more options asynchronously from Moodle.\n        VIEW.getoptions = $.Deferred();\n        $.ajax({\n            \"url\": VIEW.viewajaxurl,\n            \"type\": \"POST\",\n            \"data\": {\n                \"id\": VIEW.cmid,\n                \"action\": \"getoptions\",\n                \"sesskey\": VIEW.moodlesesskey\n            },\n            \"dataType\": \"json\",\n            \"success\": function (opts) {\n                for (var i in opts) {\n                    VIEW[i] = opts[i];\n                }\n                VIEW.getoptions.resolve();\n            }\n        });\n\n        // Ensure ECSDK is fully loaded before it is used\n        VIEW.ECSDK = $.Deferred();\n        $.when(VIEW.getoptions).done(function () {\n            // Set appropriate SDK url for specified SDK version\n            if (VIEW.sdkmode == 1) {\n                // Development mode\n                VIEW.sdkurl = \"https://www.qaenglishcentral.com\";\n            } else {\n                // Production mode\n                VIEW.sdkurl = \"https://www.englishcentral.com\";\n            }\n            if (VIEW.sdkversion == \"JSDK2\") {\n                // JSDK2 (available until Sept 2018)\n                VIEW.sdkurl += \"/partnersdk/sdk.js\";\n            } else {\n                // JSDK3 (available from July 2017)\n                VIEW.sdkurl += \"/dist/sdk/sdk.js\";\n            }\n            $.ajax({\n                url: VIEW.sdkurl,\n                dataType: \"script\",\n                cache: true\n            }).done(function () {\n                VIEW.ECSDK.resolve(window.ECSDK);\n            });\n\n            $(\".activity-title\").each(function () {\n                var url = this.dataset.videoDetailsUrl;\n                if (url) {\n                    // Create the icon\n                    var src = $(\".removevideo img\").prop(\"src\")\n                        .replace(\"removevideo\", \"i/info\")\n                        .replace(\"mod_englishcentral\", \"core\");\n                    var icon = HTML.emptytag(\"img\", {\n                        \"src\": src,\n                        \"class\": \"icon infoicon\",\n                        \"title\": VIEW.str.info\n                    });\n                    // Convert icon to a clickable link.\n                    icon = $(HTML.tag(\"a\", icon, {\n                        \"href\": url,\n                        \"style\": \"position: absolute;\"\n                    }));\n                    icon.click(function (evt) {\n                        VIEW.open_window(this.href);\n                        evt.stopPropagation();\n                        evt.preventDefault();\n                        return false;\n                    });\n                    // Make room for the icon, and then insert it.\n                    $(this).css({ \"margin-left\": \"0px\" }).before(icon);\n                }\n            });\n        });\n\n        VIEW.init_big_player_placeholder();\n\n\n        $('body').on('click',\n            '.activity-title, .englishcentral_videos .thumb-frame, .video-placeholder-video-image, .video-placeholder-video-big-play-button, .video-placeholder-text-social, .video-placeholder-text-progress',\n            function (evt) {\n                VIEW.play_video(evt, this);\n                $(\".video-placeholder\").hide();\n                $(\".faux-loader\").show();\n                $(\".faux-loader\").delay(2000).fadeOut('slow');\n                evt.stopPropagation();\n                evt.preventDefault();\n                return false;\n        });\n\n        // Make the video thumnails sortable\n        $(\".englishcentral_videos\").sortable({\n            \"cursor\": \"grabbing\",\n            \"items\": \".activity-thumbnail\",\n            \"update\": function (evt, ui) {\n                var url = ui.item.find(\".activity-title\").data(\"url\");\n                var data = {\n                    \"dialogId\": VIEW.get_videoid_from_url(url),\n                    \"sortorder\": ui.item.index() + 1\n                };\n                $.ajax({\n                    \"url\": VIEW.viewajaxurl,\n                    \"type\": \"POST\",\n                    \"data\": {\n                        \"id\": VIEW.cmid,\n                        \"data\": data,\n                        \"action\": \"sortvideo\",\n                        \"sesskey\": VIEW.moodlesesskey\n                    },\n                    \"dataType\": \"html\",\n                    \"success\": function (html) {\n                        if (html) {\n                            // Probably an error message\n                            $(\"#\" + VIEW.playercontainer).html(html);\n                        }\n                    }\n                });\n            }\n        });\n\n        // Make the video thumnails draggable\n        // $(\".activity-thumbnail\").draggable({\n        // });\n\n        $(\".removevideo\").droppable({\n            \"drop\": function (evt, ui) {\n                if (confirm(VIEW.str.confirmremovevideo)) {\n                    ui.draggable.remove();\n                    var url = ui.draggable.find(\".activity-title\").data(\"url\");\n                    var data = {\n                        \"dialogId\": VIEW.get_videoid_from_url(url)\n                    };\n                    $.ajax({\n                        \"url\": VIEW.viewajaxurl,\n                        \"type\": \"POST\",\n                        \"data\": {\n                            \"id\": VIEW.cmid,\n                            \"data\": data,\n                            \"action\": \"removevideo\",\n                            \"sesskey\": VIEW.moodlesesskey\n                        },\n                        \"dataType\": \"html\",\n                        \"success\": function (html) {\n                            if (html) {\n                                // Probably an error message\n                                $(\"#\" + VIEW.playercontainer).html(html);\n                            }\n                        }\n                    });\n                }\n            }\n        });\n\n        // Override standard form submit action\n        $(\"#\" + VIEW.searchcontainer + \" .search-form\").submit(function (evt) {\n\n            // Remove player and previous search results\n            VIEW.clear_searchresults();\n\n            // RegExp to match a list of comma-separated values\n            var list = new RegExp(\"^\\s*[0-9]+([, \\\\t\\\\r\\\\n]+[0-9]+)*\\s*$\");\n\n            var term = $(\"#id_searchterm\").val();\n            var level = $(\"[name='level[]']:checked\").map(function () {\n                return this.value;\n            }).get().join(',');\n            if (term == \"\") {\n                $(\".search-results\").html(VIEW.str.videosearchhelp);\n            } else if (term.match(list)) {\n                VIEW.fetch_videos(null, null, term, level);\n            } else {\n                VIEW.search_videos(null, null, term, level);\n            }\n            evt.preventDefault();\n        });\n\n        // Add event event handler to show/hide advanced settings\n        $(\"#\" + VIEW.searchcontainer + \" .search-advanced\").click(function () {\n            if ($(this).text() == VIEW.str.showadvanced) {\n                $(this).text(VIEW.str.hideadvanced);\n            } else {\n                $(this).text(VIEW.str.showadvanced);\n            }\n            $(\"#\" + VIEW.searchcontainer + \" .search-fields\").find(\"dt:not(.visible), dd:not(.visible)\").toggle();\n        });\n\n        // Setting 'Add video' interaction mechanics\n        var idSearchContainer = $('#id_searchcontainer');\n        var fauxsearchButton = $('#faux-search-button');\n        var closeSearchButton = $('#close-search-button');\n        var searchBox = $('.search-box');\n        var searchResults = $('.search-results');\n\n        if (fauxsearchButton || closeSearchButton) {\n\n            // When clicking on the \"Add video\" button, it displays the full search view.\n            fauxsearchButton.click(function () {\n                searchBox.css(\"display\", \"flex\");\n                searchResults.css(\"display\", \"flex\");\n                idSearchContainer.css({ \"width\": \"auto\", \"height\": \"auto\" });\n                fauxsearchButton.css(\"display\", \"none\");\n                closeSearchButton.css(\"display\", \"flex\");\n            });\n            // When clicking on the times closing button, it hides the full search view and returns to the initial state.\n            closeSearchButton.click(function () {\n                searchBox.css(\"display\", \"none\");\n                searchResults.css(\"display\", \"none\");\n                idSearchContainer.css({ \"width\": \"178px\", \"height\": \"110px\" });\n                fauxsearchButton.css(\"display\", \"flex\");\n                closeSearchButton.css(\"display\", \"none\");\n            });\n        }\n\n    };\n\n    VIEW.init_big_player_placeholder = function(){\n        // Composing video placeholder on initial load\n        // by getting data from the first element loaded\n        // in the video thumbnails\n        var activityThumbnail = $('.activity-thumbnail').first();\n        var thumbOutline = activityThumbnail.children('.thumb-outline');\n        var videoPlaceholderVideo = $('.video-placeholder-video');\n\n        // Getting and setting the title\n        var activityTitle = thumbOutline.children('.activity-title').text();\n        var videoPlaceholderTextTitle = $('.video-placeholder-text-title');\n        videoPlaceholderTextTitle.text(activityTitle);\n\n        // Getting and setting the difficulty level\n        var activityLevel = thumbOutline.find('.difficulty-level').text();\n        var levelNumber = activityLevel.slice(-1);\n        var videoPlaceholderTextLabel = $('.video-placeholder-text-label');\n        videoPlaceholderTextLabel.text(levelNumber);\n        if (levelNumber == 1 || levelNumber == 2) {\n            videoPlaceholderTextLabel.addClass('label-green');\n        } else if (levelNumber == 3 || levelNumber == 4) {\n            videoPlaceholderTextLabel.addClass('label-blue');\n        } else {\n            videoPlaceholderTextLabel.addClass('label-black');\n        }\n\n        // Getting and setting the difficulty label\n        var difficultyLabel = thumbOutline.find('.difficulty-label').text();\n        var videoPlaceholderTextLevel = $('.video-placeholder-text-level');\n        videoPlaceholderTextLevel.text(difficultyLabel);\n\n        if (levelNumber == 1 || levelNumber == 2) {\n            videoPlaceholderTextLevel.addClass('level-green');\n        } else if (levelNumber == 3 || levelNumber == 4) {\n            videoPlaceholderTextLevel.addClass('level-blue');\n        } else {\n            videoPlaceholderTextLevel.addClass('level-black');\n        }\n\n        // Getting and setting the video description\n        var activityDescription = thumbOutline.find('.thumb-frame').attr(\"description\");\n        var videoPlaceholderTextDescription = $('.video-placeholder-text-description');\n        videoPlaceholderTextDescription.text(activityDescription);\n\n        // Getting and setting the topics\n        var activityTopics = thumbOutline.find('.thumb-frame').attr(\"topics\");\n        var videoPlaceholderTextTags = $('.video-placeholder-text-tags');\n        videoPlaceholderTextTags.text(activityTopics);\n\n        // Creating, appending, getting and setting the image\n        var activityImage = thumbOutline.children('.thumb-frame').attr(\"data-demopicurl\");\n        var activityVideoId = thumbOutline.children('.thumb-frame').attr(\"data-url\");\n        var $newImage = $(\"<img>\");\n        $newImage.attr(\"src\", activityImage);\n        $newImage.attr(\"data-url\", activityVideoId);\n        $newImage.attr(\"class\", \"video-placeholder-video-image\");\n        videoPlaceholderVideo.empty();\n        videoPlaceholderVideo.append($newImage);\n\n        // Setting the social buttons\n        var fauxSocialButtons = $('.video-placeholder-text-social');\n        fauxSocialButtons.attr(\"data-url\", activityVideoId);\n\n        // Setting the text progress\n        var videoPlaceholderTextProgress = $('.video-placeholder-text-progress');\n        videoPlaceholderTextProgress.attr(\"data-url\", activityVideoId);\n\n        // Creating, appending, getting and setting the big play button\n        var $bigPlayButton = $(\"<img>\");\n        $bigPlayButton.attr(\"src\", 'pix/big-play-icon.svg');\n        $bigPlayButton.attr(\"data-url\", activityVideoId);\n        $bigPlayButton.attr(\"class\", \"video-placeholder-video-big-play-button\");\n        videoPlaceholderVideo.append($bigPlayButton);\n\n    };\n\n    VIEW.play_video = function (evt, elm) {\n\n        // Make sure the ECSDK object is available\n        // and also pass through evt and elm\n        $.when(VIEW.ECSDK, evt, elm).done(function (ecsdk, evt, elm) {\n\n            // Remove player and previous search results\n            VIEW.clear_player_and_searchresults();\n\n            // Set handler for end of mode\n            var setHandler = \"\";\n            if (ecsdk.setOnProgressEventHandler) {\n                setHandler = \"setOnProgressEventHandler\";\n            } else if (ecsdk.setOnModeEndHandler) {\n                 // The old way. May be deprecated.\n                setHandler = \"setOnModeEndHandler\";\n            }\n            if (setHandler) {\n                ecsdk[setHandler](function (data) {\n                    // TODO: remove use of LOG in production sites.\n                    LOG.debug(data);\n                    switch (data.eventType) {\n\n                        // Starting events.\n                        case \"StartActivityWatch\":\n                        case \"StartActivityLearn\":\n                        case \"StartActivitySpeak\":\n                        case \"StartDiscussion\":\n                            return false;\n\n                        case \"DialogLineWatch\":\n                            var thumbframe = \".thumb-frame[data-url$=\" + data.dialogID + \"]\";\n                            if ($(thumbframe + \" .watch-status\").length) {\n                                return false;\n                            }\n                            break;\n\n                         // Intermittent events.\n                        case \"TypedWord\":\n                        case \"StudiedWord\":\n                        case \"DiscussionQuestionDraft\":\n                        case \"DiscussionQuestionAnswer\":\n                            return false;\n\n                        // Final step before completion events.\n                        case \"DialogLineSpeak\":\n                        case \"LearnedWord\":\n                            break;\n\n                        // Completion events.\n                        case \"CompleteActivityWatch\":\n                        case \"CompleteActivityLearn\":\n                        case \"CompleteActivitySpeak\":\n                        case \"CompleteDiscussion\":\n                            break;\n\n                        default:\n                            // Oops - an unexpected value\n                            break;\n                    }\n\n                    // AJAX call to send the data.dialogID to the Moodle server\n                    // and receive the html for the updated Progress pie-charts\n                    $.ajax({\n                        \"url\": VIEW.viewajaxurl,\n                        \"type\": \"POST\",\n                        \"data\": {\n                            \"id\": VIEW.cmid,\n                            \"data\": {\n                                \"dialogID\": data.dialogID,\n                                \"sdktoken\": VIEW.sdktoken\n                            },\n                            \"action\": \"storeresults\",\n                            \"sesskey\": VIEW.moodlesesskey\n                        },\n                        \"dataType\": \"html\"\n                    }).done(function (html) {\n\n                        // Is this a PHP error reported as a JSON string?\n                        // e.g. a session timeout.\n                        if (html.match(new RegExp(\"^\\\\{.*\\\\}$\"))) {\n                            html = html.replace(new RegExp(\"\\\\n\", \"g\"), \"\\\\\\\\n\");\n                            html = JSON.parse(html);\n                            if (html.error) {\n                                html = html.error.replace(new RegExp(\"\\\\n\", \"g\"), \"<br>\");\n                            } else {\n                                html = html.toString().substr(0, 200);\n                                html = 'Sorry, there was an unknown error on the server.\\n' + html;\n                            }\n\n                            if (VIEW.dialog) {\n                                if (VIEW.dialog.dialog(\"isOpen\")) {\n                                    VIEW.dialog.dialog(\"close\");\n                                }\n                            } else {\n                                VIEW.dialog = $(\"<div></div>\").addClass(\"dialog\");\n                                VIEW.dialog.dialog({ \"autoOpen\": false });\n                            }\n                            VIEW.dialog.html(html);\n\n                            VIEW.dialog.dialog(\"option\", \"title\", VIEW.str.error);\n                            VIEW.dialog.dialog(\"option\", \"buttons\", [{\n                                \"text\": VIEW.str.ok,\n                                // \"icon\": \"ui-icon-check\",\n                                \"click\": function () {\n                                    $(this).dialog(\"close\");\n                                    var href = VIEW.viewajaxurl.replace(\".ajax\", \"\");\n                                    window.location.href = href + \"?id=\" + VIEW.cmid;\n                                }\n                            }]);\n                            VIEW.dialog.dialog(\"open\");\n                            return false;\n                        }\n\n                        if (html.indexOf(\"englishcentral_progress\") < 0) {\n                            // Probably an error message\n                            $(\".englishcentral_progress\").html(html);\n                        } else {\n                            $(\".englishcentral_progress\").replaceWith(html);\n                        }\n\n                        // AJAX call to send the data.dialogID to the Moodle server\n                        // and receive the html for the updated status of this video\n                        $.ajax({\n                            \"url\": VIEW.viewajaxurl,\n                            \"type\": \"POST\",\n                            \"data\": {\n                                \"id\": VIEW.cmid,\n                                \"data\": {\n                                    \"dialogID\": data.dialogID,\n                                    \"sdktoken\": VIEW.sdktoken\n                                },\n                                \"action\": \"showstatus\",\n                                \"sesskey\": VIEW.moodlesesskey\n                            },\n                            \"dataType\": \"html\"\n                        }).done(function (html) {\n                            var thumb = $(\".thumb-frame[data-url$=\" + data.dialogID + \"]\");\n                            thumb.find(\".watch-status, .learn-status, .speak-status, .chat-status\").remove();\n                            thumb.find(\".play-icon\").after(html);\n                        });\n                    });\n                });\n            }\n\n            var dialogId = VIEW.get_videoid(elm);\n            var completed = \".thumb-frame[data-url$=\" + dialogId + \"] .watch-status.completed\";\n\n            // Set player options (JSDK2 and JSDK3)\n            var options = {\n                \"partnerKey\": VIEW.consumerkey,\n                \"partnerSdkToken\": VIEW.sdktoken,\n                \"container\": VIEW.playercontainer,\n                \"dialogId\": dialogId,\n                \"settings\": VIEW.settings\n            };\n\n            if (VIEW.sdkversion == \"JSDK3\") {\n                // JSDK3 (from July 2018)\n                options.lang = VIEW.sitelanguage;\n            } else {\n                // JSDK2 (until Sept 2018)\n                options.siteLanguage = VIEW.sitelanguage;\n                options.autoStart = $(completed).length;\n                options.activityPanelEnabled = false;\n                options.interstitialsEnabled = true;\n                options.learnMode = true;\n                options.speakMode = true;\n                options.quizMode = true;\n                // Options.newWindow = (is_iOS ? true : false);\n                // options.goLiveMode = true;\n                options.width = 640;\n\n                // Set player width and height, in order to see WLS controls\n                var w = window.outerWidth - $(\"#\" + VIEW.playercontainer).offset().left - 24;\n                if (options.width > w) {\n                    options.width = w;\n                } else if (w > 1000) {\n                    options.width = 1000;\n                } else {\n                    options.height = 655;\n                }\n            }\n            LOG.debug('options: ' + JSON.stringify(options));\n            // Initialize EC player\n            ecsdk.loadWidget(\"player\", options);\n        });\n    };\n\n    VIEW.clear_searchresults = function () {\n        $(\"#\" + VIEW.searchcontainer + \" .search-results\").html(\"\");\n    };\n\n    VIEW.clear_player_and_searchresults = function () {\n        $(\"#\" + VIEW.playercontainer).html(\"\");\n        $(\"#\" + VIEW.searchcontainer + \" .search-results\").html(\"\");\n    };\n\n    VIEW.fetch_videos = function (page, size, term, level) {\n        var spacer = new RegExp(\"[, \\\\t\\\\r\\\\n]+\", \"g\");\n        var ids = term.replace(spacer, \",\");\n        VIEW.set_search_params(page, size, ids, level);\n        var data = {\n            \"dialogIDs\": ids,\n            \"page\": VIEW.searchpage,\n            \"pageSize\": VIEW.searchsize,\n            \"siteLanguage\": VIEW.siteanguage\n        };\n        $.ajax({\n            \"url\": VIEW.fetchurl,\n            \"type\": \"GET\",\n            \"data\": data,\n            \"dataType\": \"json\",\n            \"headers\": {\n                \"Accept\": VIEW.accept1,\n                \"Authorization\": VIEW.authorization,\n                \"Content-Type\": \"application/json\"\n            },\n            \"success\": function (dialogs) {\n                var info = false;\n                // If we have results, format as view expects and list them up\n                if (dialogs && dialogs.length > 0) {\n                    info = { count: dialogs.length, results: [] };\n                    for (var i = 0; i < dialogs.length; i++) {\n                        var highlights = {};\n                        highlights.en_name = [\"<em>\" + dialogs[i].title + \"</em>\"];\n                        highlights.en_topic = [\"<em>\" + dialogs[i].topics[0].name + \"</em>\"];\n                        highlights.en_description = [dialogs[i].description];\n                        info.results.push({ score: 150, value: dialogs[i], highlights: highlights });\n                    }\n                }\n                VIEW.format_results(info);\n            }\n        });\n    };\n\n    VIEW.search_videos = function (page, size, term, level) {\n        VIEW.set_search_params(page, size, term, level);\n        var data = {\n            \"term\": VIEW.searchterm,\n            \"page\": VIEW.searchpage,\n            \"pageSize\": VIEW.searchsize\n        };\n        if (level) {\n            data.difficulty = level;\n        }\n        if (VIEW.searchterm) {\n            $.ajax({\n                \"url\": VIEW.searchurl,\n                \"type\": \"GET\",\n                \"data\": data,\n                \"dataType\": \"json\",\n                \"headers\": {\n                    \"Accept\": VIEW.accept1,\n                    \"Authorization\": VIEW.authorization,\n                    \"Content-Type\": \"application/json\"\n                },\n                \"success\": function (info) {\n                    VIEW.format_results(info);\n                },\n                \"error\" : function () {\n                    var html = VIEW.format_noresult();\n                    $(\".search-results\").html(html);\n                }\n            });\n        }\n    };\n\n    VIEW.set_search_params = function (page, size, term, level) {\n        if (VIEW.isNotNum(page)) {\n            VIEW.searchpage = 0;\n            VIEW.searchterm = \"\";\n            VIEW.searchlevel = \"\";\n        } else {\n            VIEW.searchpage = parseInt(page);\n        }\n        if (size) {\n            VIEW.searchsize = parseInt(size);\n        }\n        if (term) {\n            VIEW.searchterm = term;\n        }\n        if (level) {\n            VIEW.searchlevel = level;\n        }\n    };\n\n    VIEW.format_results = function (info) {\n        var html = \"\";\n\n        // Finish early if there are no results\n        if ((!info) || (!info.results) || info.results.length == 0) {\n             // Populate search results\n             html += VIEW.format_noresult();\n             $(\".search-results\").html(html);\n             return;\n        }\n\n        // Cache the paging-bar (we need it twice)\n        var pagingbar = VIEW.pagingbar(info.count);\n\n\n        // Add results\n        var videoids = VIEW.get_videoids();\n        for (var i = 0; i < info.results.length; i++) {\n            // Skip videos that are already displayed\n            var id = info.results[i].value.dialogID.toString();\n            if (videoids.indexOf(id) < 0) {\n                html += VIEW.format_result(info.results[i]);\n            }\n        }\n\n        // Add bottom paging-bar\n        html += pagingbar;\n\n        // Populate search results\n        $(\".search-results\").html(html);\n\n        // Add number of items found\n        STR.get_string(\"xitemsfound\", VIEW.plugin, VIEW.formatnumber(info.count)).done(function (s) {\n            $(\".search-results\").prepend(HTML.tag(\"div\", s, { \"class\": \"itemsfound\" }));\n        });\n\n        // Add click handlers for \"+\" and thumbnail\n        for (var i = 0; i < info.results.length; i++) {\n            var v = info.results[i].value;\n            var data = {\n                \"dialogId\": v.dialogID,\n                \"title\": v.title,\n                \"duration\": v.duration,\n                \"difficulty\": v.difficulty,\n                \"dialogURL\": v.dialogURL,\n                \"thumbnailURL\": v.thumbnailURL,\n                \"demoPictureURL\": v.demoPictureURL,\n                \"description\": v.description,\n                \"topics\": JSON.stringify(v.topics),\n            };\n            var id = \"#id_add_video_\" + data.dialogId;\n            $(id).data(data);\n            $(id).parent().click(function (evt) {\n                if ($(evt.target).closest('.result-info').length) {\n                    return; // Exit the function early\n                }\n                // Run your add_video function\n                VIEW.add_video(evt, this);\n            });\n            $(id).siblings(\".result-thumb\").click(function () {\n                // VIEW.open_window($(this).data(\"url\"));\n            });\n            $(id).siblings(\".result-info\").find(\".video-info\").click(function () {\n                var id = $(this).closest(\".result-info\").siblings(\".result-add\").prop(\"id\");\n                VIEW.open_window(VIEW.videoinfourl + \"/\" + VIEW.get_videoid_from_id(id));\n            });\n        }\n\n        // Add click handlers for page numbers on paging-bar\n        $(\".pagingbar\").find(\".pagenumber:not(.currentpage)\").click(function () {\n            var page = $(this).text() - 1;\n            VIEW.search_videos(page);\n        });\n    };\n\n    VIEW.get_videoids = function () {\n        var videoids = [];\n        $(\".englishcentral_videos .activity-title\").each(function () {\n            videoids.push(VIEW.get_videoid(this));\n        });\n        return videoids;\n    };\n\n    VIEW.get_videoid = function (elm) {\n        var url = $(elm).data(\"url\");\n        return VIEW.get_videoid_from_url(url);\n    };\n\n    VIEW.get_videoid_from_url = function (url) {\n        // Sample href: https://www.qaenglishcentral.com/video/28864\n        return url.replace(new RegExp(\"^.*/\"), \"\");\n    };\n\n    VIEW.get_videoid_from_id = function (id) {\n        // Sample id: id_add_video_27323\n        return id.replace(new RegExp(\"^.*_\"), \"\");\n    };\n\n    VIEW.open_window = function (url) {\n        var w = Math.min(640, window.innerWidth);\n        var h = Math.min(480, window.innerHeight);\n        var x = window.outerWidth / 2 + window.screenX - (w / 2);\n        var y = window.outerHeight / 2 + window.screenY - (h / 2);\n        var options = \"width=\" + w + \",height=\" + h + \",top=\" + y + \",left=\" + x;\n        var win = window.open(url, VIEW.targetwindow, options);\n        if (win.focus) {\n            win.focus();\n        }\n    };\n\n    VIEW.pagingbar = function (count) {\n        var html = \"\";\n        if (count) {\n            var size = VIEW.searchsize;\n            var lastpage = Math.ceil(count / size) - 1;\n            if (lastpage > 0) {\n                var firstpage = 0;\n\n                var page = VIEW.searchpage;\n                var p_min = Math.max(firstpage, VIEW.searchpage - 4);\n                var p_max = Math.min(lastpage, Math.max(9, VIEW.searchpage + 4));\n\n                if (firstpage < p_min) {\n                    html += HTML.tag(\"span\", (firstpage + 1), { \"class\": \"pagenumber\" });\n                    if ((p_min - firstpage) > 1) {\n                        html += HTML.tag(\"span\", \"...\", { \"class\": \"pageseparator\" });\n                    }\n                }\n                for (var p = p_min; p <= p_max; p++) {\n                    var s = \"pagenumber\";\n                    if (p == page) {\n                        s += \" currentpage\";\n                    }\n                    html += HTML.tag(\"span\", (p + 1), { \"class\": s });\n                }\n                if (p_max < lastpage) {\n                    if ((lastpage - p_max) > 1) {\n                        html += HTML.tag(\"span\", \"...\", { \"class\": \"pageseparator\" });\n                    }\n                    html += HTML.tag(\"span\", (lastpage + 1), { \"class\": \"pagenumber\" });\n                }\n            }\n        }\n        if (html) {\n            html = HTML.tag(\"div\", html, { \"class\": \"pagingbar\" });\n        }\n        return html;\n    };\n\n    VIEW.formatnumber = function (n, separator) {\n        if (typeof (separator) == \"undefined\") {\n            separator = \",\";\n        }\n        if (typeof (n) == \"number\") {\n            n = n.toString();\n        }\n        // \"B\" metachar means \"not at beginning or end of word\"\n        var regexp = new RegExp(\"\\\\B(?=(\\\\d{3})+(?!\\\\d))\", \"g\");\n        return n.replace(regexp, separator);\n    };\n\n    VIEW.add_video = function (evt, elm) {\n        $.ajax({\n            \"url\": VIEW.viewajaxurl,\n            \"type\": \"POST\",\n            \"data\": {\n                \"id\": VIEW.cmid,\n                \"data\": $(elm).children(\":first\").data(),\n                \"action\": \"addvideo\",\n                \"sesskey\": VIEW.moodlesesskey\n            },\n            \"dataType\": \"html\",\n            \"success\": function (html) {\n                $(html).insertBefore(\".removevideo\").find(\".thumb-frame\").click(function (evt) {\n                    VIEW.play_video(evt, this);\n                    $(\".video-placeholder\").hide();\n                    $(\".faux-loader\").show();\n                    $(\".faux-loader\").delay(2000).fadeOut('slow');\n                    evt.stopPropagation();\n                    evt.preventDefault();\n                    return false;\n                });\n                //show the remove button if it is hidden\n                $(\".videoicon.removevideo\").removeClass('page-mod-englishcentral-hide');\n                //show the preview panel if it is hidden\n                $(\".player-container-class\").removeClass('page-mod-englishcentral-hide');\n                //hide the no videos link if it is showing, and also set the big player placeholder\n                if($(\".ec-novideos-label\").hasClass('page-mod-englishcentral-hide')==false){\n                    $(\".ec-novideos-label\").addClass('page-mod-englishcentral-hide');\n                    VIEW.init_big_player_placeholder();\n                }\n            }\n        });\n\n        // Remove this \"result-item\" from \"search-results\"\n        $(elm).closest(\".result-item\").fadeTo(1000, 0.01, function () {\n            $(this).slideUp(150, function () {\n                $(this).remove();\n            });\n        });\n        // https://stackoverflow.com/questions/1807187/how-to-remove-an-element-slowly-with-jquery\n    };\n\n    // If no search results were returned we send back a message about that.\n    VIEW.format_noresult = function() {\n        return HTML.tag(\"div\", VIEW.str.noitemsfound, {\n            \"class\": \"itemsfound\"\n        });\n    };\n\n    // \"dialogID\": 11875,\n    // \"title\": \"The Japanese Are Very Important\",\n    // \"description\": \"A global economy analyst discusses globalization and its influence on countries like Japan.\",\n    // \"difficulty\": 4,\n    // \"duration\": \"00:02:07\",\n    // \"dateModified\": \"2017-08-03T11:20:30.000Z\",\n    // \"dateFirstPublished\": \"2011-05-12T17:04:26.000Z\",\n    // \"popularityWeight\": 1.76737,\n    // \"slowSpeakAudioURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/slowspeakaudio_11875_84768.mp3\",\n    // \"dialogURL\": \"https://www.qaenglishcentral.com/video/11875\",\n    // \"thumbnailURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/thumb_11875_20160719065106.jpg\",\n    // \"featurePictureURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/featureddialog_11875_20160719065115.jpg\",\n    // \"demoPictureURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/demopicture_11875_20160719065122.jpg\",\n    // \"videoDetailsURL\": \"https://www.qaenglishcentral.com/videodetails/11875\",\n    // \"seriesThumbnailURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/dialogseriesthumbnail_11875_20160719065111.jpg\",\n    // \"dialogM4aAudioURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/audio_11875_20130527081953.m4a\",\n    // \"smallVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videomobile_11875_20140205180008.mp4\",\n    // \"mediumVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videoslowconn_11875_20131130050102.mp4\",\n    // \"largeVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videoh264_11875_20130527081953.mp4\",\n    // \"promotionalDialog\": false,\n\n    VIEW.format_result = function (r) {\n        if (VIEW.isNotNum(r.value.difficulty) || r.value.difficulty < 1 || r.value.difficulty > 7) {\n            r.value.difficulty = 0;\n            r.difficulty = \"unknown\";\n        } else {\n            switch (true) {\n                case (r.value.difficulty <= 2): r.difficulty = \"beginner\"; break;\n                case (r.value.difficulty <= 4): r.difficulty = \"intermediate\"; break;\n                case (r.value.difficulty <= 7): r.difficulty = \"advanced\"; break;\n            }\n        }\n        var html = \"\";\n        html += VIEW.format_add(r);\n        html += VIEW.format_thumb(r);\n        html += VIEW.format_info(r);\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-item\"\n        });\n    };\n\n    VIEW.format_add = function (r) {\n        var src = $(\".removevideo img\").prop(\"src\").replace(\"removevideo\", \"add\");\n        var html = HTML.emptytag(\"img\", {\n            \"src\": src,\n            \"title\": VIEW.str.addthisvideo\n        });\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-add\",\n            \"id\": \"id_add_video_\" + r.value.dialogID\n        });\n    };\n\n    VIEW.format_thumb = function (r) {\n        var duration = r.value.duration.replace(new RegExp(\"^00:\"), \"\");\n        var html = \"\";\n        html += HTML.starttag(\"div\", {\n            \"class\": \"thumb-frame\",\n            \"style\": \"background-image: url('\" + r.value.thumbnailURL + \"')\"\n        });\n        html += HTML.tag(\"div\", r.value.difficulty, {\n            \"class\": \"result-difficulty \" + r.difficulty\n        });\n        html += HTML.tag(\"div\", duration, {\n            \"class\": \"result-duration\"\n        });\n        html += HTML.endtag(\"div\");\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-thumb\",\n            \"data-url\": r.value.dialogURL,\n        });\n    };\n\n    VIEW.format_info = function (r) {\n        var html = \"\";\n        var src = $(\".removevideo img\").prop(\"src\")\n            .replace(\"removevideo\", \"i/info\")\n            .replace(\"mod_englishcentral\", \"core\");\n        var title = r.value.title;\n        if (r.highlights.en_name) {\n            title = r.highlights.en_name[0];\n        }\n        html += HTML.tag(\"h2\", title, {\n            \"class\": \"result-title\"\n        });\n        html += HTML.tag(\"div\", \"\", {\n            \"src\": src,\n            \"class\": \"video-info\",\n            \"data-toggle\": \"tooltip\",\n            \"data-placement\": \"left\",\n            \"title\": VIEW.str.videodetails\n        });\n        html += VIEW.format_details(r);\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-info\"\n        });\n    };\n\n    VIEW.format_details = function (r) {\n        var html = \"\";\n        // Html += VIEW.format_copyright(r.value.copyright);\n        html += VIEW.format_goalstopics(r.value.goals, r.value.topics, r.difficulty);\n        html += VIEW.format_description(r.value.description);\n        html += VIEW.format_transcript(r.highlights.transcript);\n        return HTML.tag(\"dl\", html, {\n            \"class\": \"result-details\"\n        });\n    };\n\n    VIEW.format_copyright = function (copyright) {\n        if (copyright && copyright.length) {\n            return VIEW.format_detail(\"copyright\", copyright);\n        }\n        return \"\";\n    };\n\n    VIEW.format_goalstopics = function (goals, topics, difficulty) {\n        var txt = [];\n        if (goals && goals.length) {\n            for (var i = 0; i < goals.length; i++) {\n                txt.push(goals[i].title);\n            }\n        }\n        if (topics && topics.length) {\n            for (var i = 0; i < topics.length; i++) {\n                txt.push(topics[i].name);\n            }\n        }\n        if (txt.length == 0) {\n            return \"\";\n        }\n        txt = txt.join(\", \");\n        txt += HTML.tag(\"span\", VIEW.str[difficulty], {\n            \"class\": \"result-level \" + difficulty\n        });\n        return VIEW.format_detail(\"topics\", txt);\n    };\n\n    VIEW.format_description = function (description) {\n        if (description && description.length) {\n            return VIEW.format_detail(\"description\", description);\n        }\n        return \"\";\n    };\n\n    VIEW.format_transcript = function (transcript) {\n        if (transcript && transcript.length) {\n            var dots = \"...\";\n            var slashes = new RegExp(\"//\", \"g\");\n            return VIEW.format_detail(\"transcript\", dots + transcript[0].replace(slashes, dots) + dots);\n        }\n        return \"\";\n    };\n\n    VIEW.format_detail = function (type, value) {\n        var html = \"\";\n        html += HTML.tag(\"dt\", VIEW.str[type], {\n            \"class\": \"result-label \" + type\n        });\n        html += HTML.tag(\"dd\", value, {\n            \"class\": \"result-value \" + type\n        });\n        return html;\n    };\n\n    VIEW.isNotNum = function (n) {\n        switch (typeof (n)) {\n            case \"number\": return false;\n            case \"string\": return (!n.match(new RegExp(\"^[0-9]+$\")));\n            default: return true; // Everything else is NOT a number\n        }\n    };\n\n    return VIEW;\n\n});\n"],"names":["define","$","JUI","LOG","STR","HTML","VIEW","get_strings","plugin","done","s","i","str","addthisvideo","advanced","beginner","confirmremovevideo","copyright","description","duration","error","goals","hideadvanced","info","intermediate","level","noitemsfound","ok","search","showadvanced","topics","transcript","videosearch","videosearchhelp","videosearchprompt","videodetails","init","opts","getoptions","Deferred","ajax","viewajaxurl","cmid","moodlesesskey","resolve","ECSDK","when","sdkmode","sdkurl","sdkversion","url","dataType","cache","window","each","this","dataset","videoDetailsUrl","src","prop","replace","icon","emptytag","tag","click","evt","open_window","href","stopPropagation","preventDefault","css","before","init_big_player_placeholder","on","play_video","hide","show","delay","fadeOut","sortable","ui","item","find","data","get_videoid_from_url","index","html","playercontainer","droppable","confirm","draggable","remove","searchcontainer","submit","clear_searchresults","list","RegExp","term","val","map","value","get","join","match","fetch_videos","search_videos","text","toggle","idSearchContainer","fauxsearchButton","closeSearchButton","searchBox","searchResults","thumbOutline","first","children","videoPlaceholderVideo","activityTitle","levelNumber","slice","videoPlaceholderTextLabel","addClass","difficultyLabel","videoPlaceholderTextLevel","activityDescription","attr","activityTopics","activityImage","activityVideoId","$newImage","empty","append","$bigPlayButton","elm","ecsdk","clear_player_and_searchresults","setHandler","setOnProgressEventHandler","setOnModeEndHandler","debug","eventType","thumbframe","dialogID","length","sdktoken","JSON","parse","toString","substr","dialog","location","indexOf","replaceWith","thumb","after","dialogId","get_videoid","completed","options","consumerkey","settings","lang","sitelanguage","siteLanguage","autoStart","activityPanelEnabled","interstitialsEnabled","learnMode","speakMode","quizMode","width","w","outerWidth","offset","left","height","stringify","loadWidget","page","size","spacer","ids","set_search_params","searchpage","searchsize","siteanguage","fetchurl","accept1","authorization","dialogs","count","results","highlights","en_name","title","en_topic","name","en_description","push","score","format_results","searchterm","difficulty","searchurl","format_noresult","isNotNum","searchlevel","parseInt","pagingbar","videoids","get_videoids","id","format_result","get_string","formatnumber","prepend","v","dialogURL","thumbnailURL","demoPictureURL","parent","target","closest","add_video","siblings","videoinfourl","get_videoid_from_id","Math","min","innerWidth","h","innerHeight","x","screenX","outerHeight","screenY","win","open","targetwindow","focus","lastpage","ceil","p_min","max","p_max","firstpage","p","n","separator","regexp","insertBefore","removeClass","hasClass","fadeTo","slideUp","r","format_add","format_thumb","format_info","starttag","endtag","format_details","format_goalstopics","format_description","format_transcript","format_copyright","format_detail","txt","slashes","type"],"mappings":"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"}