{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the term of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * load the EnglishCentral player\n *\n * @module      mod_englishcentral/view\n * @category    output\n * @copyright   Gordon Bateson\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       2.9\n */\ndefine([\"jquery\", \"jqueryui\",\"core/log\", \"core/str\", \"mod_englishcentral/html\"], function($, JUI, LOG, STR, HTML) {\n\n    /** @alias module:mod_englishcentral/view */\n    var VIEW = {};\n\n    // cache full plugin name\n    VIEW.plugin = \"mod_englishcentral\";\n\n    // define DOM element names\n    VIEW.playercontainer   = \"id_playercontainer\";\n    VIEW.progresscontainer = \"id_progresscontainer\";\n    VIEW.searchcontainer   = \"id_searchcontainer\";\n\n    // initialize search params\n    VIEW.searchpage = 0;\n    VIEW.searchsize = 20;\n    VIEW.searchterm = \"\";\n    VIEW.searchlevel = \"\";\n\n    // initialize string cache\n    VIEW.str = {};\n\n    // set up strings\n    STR.get_strings([\n        {\"key\": \"addthisvideo\",       \"component\": VIEW.plugin},\n        {\"key\": \"advanced\",           \"component\": VIEW.plugin},\n        {\"key\": \"beginner\",           \"component\": VIEW.plugin},\n        {\"key\": \"confirmremovevideo\", \"component\": VIEW.plugin},\n        {\"key\": \"copyright\",          \"component\": VIEW.plugin},\n        {\"key\": \"description\",        \"component\": VIEW.plugin},\n        {\"key\": \"duration\",           \"component\": \"search\"},\n        {\"key\": \"error\",              \"component\": \"error\"},\n        {\"key\": \"goals\",              \"component\": VIEW.plugin},\n        {\"key\": \"hideadvanced\",       \"component\": \"form\"},\n        {\"key\": \"intermediate\",       \"component\": VIEW.plugin},\n        {\"key\": \"level\",              \"component\": VIEW.plugin},\n        {\"key\": \"ok\",                 \"component\": \"moodle\"},\n        {\"key\": \"search\",             \"component\": \"moodle\"},\n        {\"key\": \"showadvanced\",       \"component\": \"form\"},\n        {\"key\": \"topics\",             \"component\": VIEW.plugin},\n        {\"key\": \"transcript\",         \"component\": VIEW.plugin},\n        {\"key\": \"videosearch\",        \"component\": VIEW.plugin},\n        {\"key\": \"videosearchhelp\",    \"component\": VIEW.plugin},\n        {\"key\": \"videosearchprompt\",  \"component\": VIEW.plugin}\n    ]).done(function(s) {\n        var i = 0;\n        VIEW.str.addthisvideo = s[i++];\n        VIEW.str.advanced = s[i++];\n        VIEW.str.beginner = s[i++];\n        VIEW.str.confirmremovevideo = s[i++];\n        VIEW.str.copyright = s[i++];\n        VIEW.str.description = s[i++];\n        VIEW.str.duration = s[i++];\n        VIEW.str.error = s[i++];\n        VIEW.str.goals = s[i++];\n        VIEW.str.hideadvanced = s[i++];\n        VIEW.str.intermediate = s[i++];\n        VIEW.str.level = s[i++];\n        VIEW.str.ok = s[i++];\n        VIEW.str.search = s[i++];\n        VIEW.str.showadvanced = s[i++];\n        VIEW.str.topics = s[i++];\n        VIEW.str.transcript = s[i++];\n        VIEW.str.videosearch = s[i++];\n        VIEW.str.videosearchhelp = s[i++];\n        VIEW.str.videosearchprompt = s[i++];\n    });\n\n    VIEW.init = function(opts) {\n\n        // Cache basic options received from Moodle, e.g. cmid, sesskey, ajax URL.\n        // These give us just enough information to get more options asynchronously.\n        for (var i in opts) {\n            VIEW[i] = opts[i];\n        }\n\n        // get more options asynchronously from Moodle\n        VIEW.getoptions = $.Deferred();\n        $.ajax({\n            \"url\": VIEW.viewajaxurl,\n            \"type\": \"POST\",\n            \"data\": {\"id\" : VIEW.cmid,\n                     \"action\": \"getoptions\",\n                     \"sesskey\" : VIEW.moodlesesskey},\n            \"dataType\": \"json\",\n            \"success\": function(opts){\n                for (var i in opts) {\n                    VIEW[i] = opts[i];\n                }\n                VIEW.getoptions.resolve();\n            }\n        });\n\n        // ensure ECSDK is fully loaded before it is used\n        VIEW.ECSDK = $.Deferred();\n        $.when(VIEW.getoptions).done(function(){\n            // set appropriate SDK url for specified SDK version\n            if (VIEW.sdkmode==1) {\n                // development mode\n                VIEW.sdkurl = \"https://www.qaenglishcentral.com\";\n            } else {\n                // production mode\n                VIEW.sdkurl = \"https://www.englishcentral.com\";\n            }\n            if (VIEW.sdkversion==\"JSDK2\") {\n                // JSDK2 (available until Sept 2018)\n                VIEW.sdkurl += \"/partnersdk/sdk.js\";\n            } else {\n                // JSDK3 (available from July 2017)\n                VIEW.sdkurl += \"/dist/sdk/sdk.js\";\n            }\n            $.ajax({\n                url: VIEW.sdkurl,\n                dataType: \"script\",\n                cache: true\n            }).done(function() {\n                VIEW.ECSDK.resolve(window.ECSDK);\n            });\n        });\n\n        $(\".activity-title, .thumb-frame\").click(function(evt) {\n            VIEW.play_video(evt, this);\n            evt.stopPropagation();\n            evt.preventDefault();\n            return false;\n        });\n\n        // make the video thumnails sortable\n        $(\".englishcentral_videos\").sortable({\n            \"cursor\": \"move\",\n            \"items\": \".activity-thumbnail\",\n            \"update\": function(evt, ui) {\n                var url = ui.item.find(\".activity-title\").data(\"url\");\n                var data = {\n                    \"dialogId\": VIEW.get_videoid_from_url(url),\n                    \"sortorder\": ui.item.index() + 1\n                };\n                $.ajax({\n                    \"url\": VIEW.viewajaxurl,\n                    \"type\": \"POST\",\n                    \"data\": {\n                        \"id\": VIEW.cmid,\n                        \"data\": data,\n                        \"action\": \"sortvideo\",\n                        \"sesskey\": VIEW.moodlesesskey\n                    },\n                    \"dataType\": \"html\",\n                    \"success\": function(html) {\n                        if (html) {\n                            // probably an error message\n                            $(\"#\" + VIEW.playercontainer).html(html);\n                        }\n                    }\n                });\n            }\n        });\n\n        // make the video thumnails draggable\n        //$(\".activity-thumbnail\").draggable({\n        //});\n\n        $(\".removevideo\").droppable({\n            \"drop\": function(evt, ui) {\n                if (confirm(VIEW.str.confirmremovevideo)) {\n                    ui.draggable.remove();\n                    var url = ui.draggable.find(\".activity-title\").data(\"url\");\n                    var data = {\n                        \"dialogId\": VIEW.get_videoid_from_url(url)\n                    };\n                    $.ajax({\n                        \"url\": VIEW.viewajaxurl,\n                        \"type\": \"POST\",\n                        \"data\": {\n                            \"id\": VIEW.cmid,\n                            \"data\": data,\n                            \"action\": \"removevideo\",\n                            \"sesskey\": VIEW.moodlesesskey\n                        },\n                        \"dataType\": \"html\",\n                        \"success\": function(html) {\n                            if (html) {\n                                // probably an error message\n                                $(\"#\" + VIEW.playercontainer).html(html);\n                            }\n                        }\n                    });\n                }\n            }\n        });\n\n        // override standard form submit action\n        $(\"#\" + VIEW.searchcontainer + \" .search-form\").submit(function(evt){\n\n            // remove player and previous search results\n            VIEW.clear_player_and_searchresults();\n\n            // RegExp to match a list of comma-separated values\n            var list = new RegExp(\"^\\s*[0-9]+([, \\\\t\\\\r\\\\n]+[0-9]+)*\\s*$\");\n\n            var term = $(\"#id_searchterm\").val();\n            var level = $(\"[name='level[]']:checked\").map(function() {return this.value;}).get().join(',');\n            if (term == \"\") {\n                $(\".search-results\").html(VIEW.str.videosearchhelp);\n            } else if (term.match(list)) {\n                VIEW.fetch_videos(null, null, term, level);\n            } else {\n                VIEW.search_videos(null, null, term, level);\n            }\n            evt.preventDefault();\n        });\n\n        // add event event handler to show/hide advanced settings\n        $(\"#\" + VIEW.searchcontainer + \" .search-advanced\").click(function(){\n            if ($(this).text()==VIEW.str.showadvanced) {\n                $(this).text(VIEW.str.hideadvanced);\n            } else {\n                $(this).text(VIEW.str.showadvanced);\n            }\n            $(\"#\" + VIEW.searchcontainer + \" .search-fields\").find(\"dt:not(.visible), dd:not(.visible)\").toggle();\n        });\n    };\n\n    VIEW.play_video = function(evt, elm) {\n\n        // make sure the ECSDK object is available\n        // and also pass through evt and elm\n        $.when(VIEW.ECSDK, evt, elm).done(function(ecsdk, evt, elm){\n\n            // remove player and previous search results\n            VIEW.clear_player_and_searchresults();\n\n            // set handler for end of mode\n            var setHandler = \"\";\n            if (ecsdk.setOnProgressEventHandler) {\n                setHandler = \"setOnProgressEventHandler\";\n            } else if (ecsdk.setOnModeEndHandler) {\n                setHandler = \"setOnModeEndHandler\";\n            }\n            if (setHandler) {\n                ecsdk[setHandler](function(data) {\nLOG.debug(data);\n                    switch (data.eventType) {\n                        case \"CompleteActivityWatch\":\n                        case \"LearnedWord\":\n                        case \"DialogLineSpeak\":\n                            break;\n\n                        case \"DialogLineWatch\":\n                            var thumbframe = \".thumb-frame[data-url$=\" + data.dialogID + \"]\";\n                            if ($(thumbframe + \" .watch-status\").length) {\n                                return false;\n                            }\n                            break;\n\n                        case \"CompleteActivityLearn\":\n                        case \"CompleteActivitySpeak\":\n                            return false;\n\n                        case \"StartActivityWatch\":\n                        case \"StartActivityLearn\":\n                        case \"TypedWord\":\n                        case \"StudiedWord\":\n                        case \"StartActivitySpeak\":\n                            return false;\n\n                        default:\n                            // oops - an unexpected value\n                            break;\n                    }\n\n                    // AJAX call to send the data.dialogID to the Moodle server\n                    // and receive the html for the updated Progress pie-charts\n                    $.ajax({\n                        \"url\": VIEW.viewajaxurl,\n                        \"type\": \"POST\",\n                        \"data\": {\n                            \"id\": VIEW.cmid,\n                            \"data\": {\n                                \"dialogID\": data.dialogID,\n                                \"sdktoken\": VIEW.sdktoken\n                            },\n                            \"action\": \"storeresults\",\n                            \"sesskey\": VIEW.moodlesesskey\n                        },\n                        \"dataType\": \"html\"\n                    }).done(function(html){\n\n                        // Is this a PHP error reported as a JSON string?\n                        // e.g. a session timeout.\n                        if (html.match(new RegExp(\"^\\\\{.*\\\\}$\"))) {\n                            html = html.replace(new RegExp(\"\\\\n\", \"g\"), \"\\\\\\\\n\");\n                            html = JSON.parse(html);\n                            if (html.error) {\n                                html = html.error.replace(new RegExp(\"\\\\n\", \"g\"), \"<br>\");\n                            } else {\n                                html = html.toString().substr(0, 200);\n                                html = 'Sorry, there was an unknown error on the server.\\n' + html;\n                            }\n\n                            if (VIEW.dialog) {\n                                if (VIEW.dialog.dialog(\"isOpen\")) {\n                                    VIEW.dialog.dialog(\"close\");\n                                }\n                            } else {\n                                VIEW.dialog = $(\"<div></div>\").addClass(\"dialog\");\n                                VIEW.dialog.dialog({\"autoOpen\": false});\n                            }\n                            VIEW.dialog.html(html);\n\n                            VIEW.dialog.dialog(\"option\", \"title\", VIEW.str.error);\n                            VIEW.dialog.dialog(\"option\", \"buttons\", [{\n                                \"text\": VIEW.str.ok,\n                                //\"icon\": \"ui-icon-check\",\n                                \"click\": function(){\n                                    $(this).dialog(\"close\");\n                                    var href = VIEW.viewajaxurl.replace(\".ajax\", \"\");\n                                    window.location.href = href + \"?id=\" + VIEW.cmid;\n                                }\n                            }]);\n                            VIEW.dialog.dialog(\"open\");\n                            return false;\n                        }\n\n                        if (html.indexOf(\"englishcentral_progress\") < 0) {\n                            // probably an error message\n                            $(\".englishcentral_progress\").html(html);\n                        } else {\n                            $(\".englishcentral_progress\").replaceWith(html);\n                        }\n\n                        // AJAX call to send the data.dialogID to the Moodle server\n                        // and receive the html for the updated status of this video\n                        $.ajax({\n                            \"url\": VIEW.viewajaxurl,\n                            \"type\": \"POST\",\n                            \"data\": {\n                                \"id\": VIEW.cmid,\n                                \"data\": {\n                                    \"dialogID\": data.dialogID,\n                                    \"sdktoken\": VIEW.sdktoken\n                                },\n                                \"action\": \"showstatus\",\n                                \"sesskey\": VIEW.moodlesesskey\n                            },\n                            \"dataType\": \"html\"\n                        }).done(function(html) {\n                            var thumb = $(\".thumb-frame[data-url$=\" + data.dialogID + \"]\");\n                            thumb.find(\".watch-status, .learn-status, .speak-status\").remove();\n                            thumb.find(\".play-icon\").after(html);\n                        });\n                    });\n                });\n            }\n\n            var dialogId = VIEW.get_videoid(elm);\n            var completed = \".thumb-frame[data-url$=\" +dialogId + \"] .watch-status.completed\";\n\n            // set player options (JSDK2 and JSDK3)\n            var options = {\n                \"partnerKey\": VIEW.consumerkey,\n                \"partnerSdkToken\": VIEW.sdktoken,\n                \"container\": VIEW.playercontainer,\n                \"dialogId\": dialogId\n            };\n\n            if (VIEW.sdkversion==\"JSDK3\") {\n                // JSDK3 (from July 2018)\n                options.lang = VIEW.sitelanguage;\n            } else {\n                // JSDK2 (until Sept 2018)\n                options.siteLanguage = VIEW.sitelanguage;\n                options.autoStart = $(completed).length;\n                options.activityPanelEnabled = false;\n                options.interstitialsEnabled = true;\n                options.learnMode = true;\n                options.speakMode = true;\n                options.quizMode = true;\n                // options.newWindow = (is_iOS ? true : false);\n                // options.goLiveMode = true;\n                options.width = 640;\n\n                // set player width and height, in order to see WLS controls\n                var w = window.outerWidth - $(\"#\" + VIEW.playercontainer).offset().left - 24;\n                if (options.width > w) {\n                    options.width = w;\n                } else if (w > 1000) {\n                    options.width = 1000;\n                } else {\n                    options.height = 655;\n                }\n            }\n\n            // initialize EC player\n            ecsdk.loadWidget(\"player\", options);\n        });\n    };\n\n    VIEW.clear_player_and_searchresults = function() {\n        $(\"#\" + VIEW.playercontainer).html(\"\");\n        $(\"#\" + VIEW.searchcontainer + \" .search-results\").html(\"\");\n    };\n\n    VIEW.fetch_videos = function(page, size, term, level) {\n        var spacer = new RegExp(\"[, \\\\t\\\\r\\\\n]+\", \"g\");\n        var ids = term.replace(spacer, \",\");\n        VIEW.set_search_params(page, size, ids, level);\n        var data = {\n            \"dialogIDs\": ids,\n            \"page\": VIEW.searchpage,\n            \"pageSize\": VIEW.searchsize,\n            \"siteLanguage\": VIEW.siteanguage\n        };\n        $.ajax({\n            \"url\": VIEW.fetchurl,\n            \"type\": \"GET\",\n            \"data\": data,\n            \"dataType\": \"json\",\n            \"headers\": {\n                \"Accept\": VIEW.accept1,\n                \"Authorization\": VIEW.authorization,\n                \"Content-Type\": \"application/json\"\n            },\n            \"success\": function(dialogs) {\n                var info = false;\n                // If we have results, format as view expects and list them up\n                if (dialogs && dialogs.length>0) {\n                    info = {count: dialogs.length, results: []};\n                    for(var i = 0; i<dialogs.length;i++){\n                        var highlights={};\n                        highlights.en_name= [\"<em>\" + dialogs[i].title +\"</em>\"];\n                        highlights.en_topic= [\"<em>\" + dialogs[i].topics[0].name +\"</em>\"];\n                        highlights.en_description=  [dialogs[i].description];\n                        info.results.push({score: 150,value: dialogs[i],highlights: highlights});\n                    }\n                }\n                VIEW.format_results(info);\n            }\n        });\n    };\n\n    VIEW.search_videos = function(page, size, term, level) {\n        VIEW.set_search_params(page, size, term, level);\n        var data = {\n            \"term\": VIEW.searchterm,\n            \"page\": VIEW.searchpage,\n            \"pageSize\": VIEW.searchsize\n        };\n        if (level) {\n            data.difficulty = level;\n        }\n        if (VIEW.searchterm) {\n            $.ajax({\n                \"url\": VIEW.searchurl,\n                \"type\": \"GET\",\n                \"data\": data,\n                \"dataType\": \"json\",\n                \"headers\": {\n                    \"Accept\": VIEW.accept1,\n                    \"Authorization\": VIEW.authorization,\n                    \"Content-Type\": \"application/json\"\n                },\n                \"success\": function(info) {\n                    VIEW.format_results(info);\n                }\n            });\n        }\n    };\n\n    VIEW.set_search_params = function(page, size, term, level) {\n        if (VIEW.isNotNum(page)) {\n            VIEW.searchpage = 0;\n            VIEW.searchterm = \"\";\n            VIEW.searchlevel = \"\";\n        } else {\n            VIEW.searchpage = parseInt(page);\n        }\n        if (size) {\n            VIEW.searchsize = parseInt(size);\n        }\n        if (term) {\n            VIEW.searchterm = term;\n        }\n        if (level) {\n            VIEW.searchlevel = level;\n        }\n    };\n\n    VIEW.format_results = function(info) {\n        var html = \"\";\n\n        // finish early if there are no results\n        if ((!info) || (!info.results) || info.results.length == 0) {\n            return html;\n        }\n\n        // cache the paging-bar (we need it twice)\n        var pagingbar = VIEW.pagingbar(info.count);\n\n        // add top paging-bar\n        html += pagingbar;\n\n        // add results\n        var videoids = VIEW.get_videoids();\n        for (var i = 0; i < info.results.length; i++) {\n            // skip videos that are already displayed\n            var id = info.results[i].value.dialogID.toString();\n            if (videoids.indexOf(id) < 0) {\n                html += VIEW.format_result(info.results[i]);\n            }\n        }\n\n        // add bottom paging-bar\n        html += pagingbar;\n\n        // populate search results\n        $(\".search-results\").html(html);\n\n        // add number of items found\n        STR.get_string(\"xitemsfound\", VIEW.plugin, VIEW.formatnumber(info.count)).done(function(s) {\n            $(\".search-results\").prepend(HTML.tag(\"div\", s, {\"class\": \"itemsfound\"}));\n        });\n\n        // add click handlers for \"+\" and thumbnail\n        for (var i = 0; i < info.results.length; i++) {\n            var v = info.results[i].value;\n            var data = {\n                \"dialogId\": v.dialogID,\n                \"title\": v.title,\n                \"duration\": v.duration,\n                \"difficulty\": v.difficulty,\n                \"dialogURL\": v.dialogURL,\n                \"thumbnailURL\": v.thumbnailURL\n            };\n            var id = \"#id_add_video_\" + data.dialogId;\n            $(id).data(data);\n            $(id).click(function(evt) {\n                VIEW.add_video(evt, this);\n            });\n            $(id).siblings(\".result-thumb\").click(function() {\n                VIEW.open_window($(this).data(\"url\"));\n            });\n            $(id).siblings(\".result-info\").find(\".icon\").click(function() {\n                var id = $(this).closest(\".result-info\").siblings(\".result-add\").prop(\"id\");\n                VIEW.open_window(VIEW.videoinfourl + \"/\" + VIEW.get_videoid_from_id(id));\n            });\n        }\n\n        // add click handlers for page numbers on paging-bar\n        $(\".pagingbar\").find(\".pagenumber:not(.currentpage)\").click(function(){\n            var page = $(this).text() - 1;\n            VIEW.search_videos(page);\n        });\n    };\n\n    VIEW.get_videoids = function() {\n        var videoids = [];\n        $(\".englishcentral_videos .activity-title\").each(function() {\n            videoids.push(VIEW.get_videoid(this));\n        });\n        return videoids;\n    };\n\n    VIEW.get_videoid = function(elm) {\n        var url = $(elm).data(\"url\");\n        return VIEW.get_videoid_from_url(url);\n    };\n\n    VIEW.get_videoid_from_url = function(url) {\n        // sample href: https://www.qaenglishcentral.com/video/28864\n        return url.replace(new RegExp(\"^.*/\"), \"\");\n    };\n\n    VIEW.get_videoid_from_id = function(id) {\n        // sample id: id_add_video_27323\n        return id.replace(new RegExp(\"^.*_\"), \"\");\n    };\n\n    VIEW.open_window = function(url) {\n        var w = Math.min(640, window.innerWidth);\n        var h = Math.min(480, window.innerHeight);\n        var x = window.outerWidth / 2 + window.screenX - (w / 2);\n        var y = window.outerHeight / 2 + window.screenY - (h / 2);\n        var options = \"width=\" + w + \",height=\" + h + \",top=\" + y + \",left=\" + x;\n        var win = window.open(url, VIEW.targetwindow, options);\n        if (win.focus) {\n            win.focus();\n        }\n    };\n\n    VIEW.pagingbar = function(count) {\n        var html = \"\";\n        if (count) {\n            var size = VIEW.searchsize;\n            var lastpage = Math.ceil(count / size) - 1;\n            if (lastpage > 0) {\n                var firstpage = 0;\n\n                var page = VIEW.searchpage;\n                var p_min = Math.max(firstpage, VIEW.searchpage - 4);\n                var p_max = Math.min(lastpage, Math.max(9, VIEW.searchpage + 4));\n\n                if (firstpage < p_min) {\n                    html += HTML.tag(\"span\", (firstpage + 1), {\"class\": \"pagenumber\"});\n                    if ((p_min - firstpage) > 1) {\n                        html += HTML.tag(\"span\", \"...\", {\"class\": \"pageseparator\"});\n                    }\n                }\n                for (var p=p_min; p<=p_max; p++) {\n                    var s = \"pagenumber\";\n                    if (p==page) {\n                        s += \" currentpage\";\n                    }\n                    html += HTML.tag(\"span\", (p+1), {\"class\": s});\n                }\n                if (p_max < lastpage) {\n                    if ((lastpage - p_max) > 1) {\n                        html += HTML.tag(\"span\", \"...\", {\"class\": \"pageseparator\"});\n                    }\n                    html += HTML.tag(\"span\", (lastpage + 1), {\"class\": \"pagenumber\"});\n                }\n            }\n        }\n        if (html) {\n            html = HTML.tag(\"div\", html, {\"class\": \"pagingbar\"});\n        }\n        return html;\n    };\n\n    VIEW.formatnumber = function(n, separator) {\n        if (typeof(separator)==\"undefined\") {\n            separator = \",\";\n        }\n        if (typeof(n)==\"number\") {\n            n = n.toString();\n        }\n        // \"B\" metachar means \"not at beginning or end of word\"\n        var regexp = new RegExp(\"\\\\B(?=(\\\\d{3})+(?!\\\\d))\", \"g\");\n        return n.replace(regexp, separator);\n    };\n\n    VIEW.add_video = function(evt, elm) {\n        $.ajax({\n            \"url\": VIEW.viewajaxurl,\n            \"type\": \"POST\",\n            \"data\": {\n                \"id\": VIEW.cmid,\n                \"data\": $(elm).data(),\n                \"action\": \"addvideo\",\n                \"sesskey\": VIEW.moodlesesskey\n            },\n            \"dataType\": \"html\",\n            \"success\": function(html) {\n                $(html).insertBefore(\".removevideo\").find(\".thumb-frame\").click(function(evt) {\n                    VIEW.play_video(evt, this);\n                    evt.stopPropagation();\n                    evt.preventDefault();\n                    return false;\n                });\n            }\n        });\n\n        // remove this \"result-item\" from \"search-results\"\n        $(elm).closest(\".result-item\").fadeTo(1000, 0.01, function() {\n            $(this).slideUp(150, function() {\n                $(this).remove();\n            });\n        });\n        // https://stackoverflow.com/questions/1807187/how-to-remove-an-element-slowly-with-jquery\n    };\n\n    //\"dialogID\": 11875,\n    //\"title\": \"The Japanese Are Very Important\",\n    //\"description\": \"A global economy analyst discusses globalization and its influence on countries like Japan.\",\n    //\"difficulty\": 4,\n    //\"duration\": \"00:02:07\",\n    //\"dateModified\": \"2017-08-03T11:20:30.000Z\",\n    //\"dateFirstPublished\": \"2011-05-12T17:04:26.000Z\",\n    //\"popularityWeight\": 1.76737,\n    //\"slowSpeakAudioURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/slowspeakaudio_11875_84768.mp3\",\n    //\"dialogURL\": \"https://www.qaenglishcentral.com/video/11875\",\n    //\"thumbnailURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/thumb_11875_20160719065106.jpg\",\n    //\"featurePictureURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/featureddialog_11875_20160719065115.jpg\",\n    //\"demoPictureURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/demopicture_11875_20160719065122.jpg\",\n    //\"videoDetailsURL\": \"https://www.qaenglishcentral.com/videodetails/11875\",\n    //\"seriesThumbnailURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/dialogseriesthumbnail_11875_20160719065111.jpg\",\n    //\"dialogM4aAudioURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/audio_11875_20130527081953.m4a\",\n    //\"smallVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videomobile_11875_20140205180008.mp4\",\n    //\"mediumVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videoslowconn_11875_20131130050102.mp4\",\n    //\"largeVideoURL\": \"https://cdna.qaenglishcentral.com/dialogs/11875/videoh264_11875_20130527081953.mp4\",\n    //\"promotionalDialog\": false,\n\n    VIEW.format_result = function(r) {\n        if (VIEW.isNotNum(r.value.difficulty) || r.value.difficulty < 1 || r.value.difficulty > 7) {\n            r.value.difficulty = 0;\n            r.difficulty = \"unknown\";\n        } else {\n            switch (true) {\n                case (r.value.difficulty <= 2): r.difficulty = \"beginner\";     break;\n                case (r.value.difficulty <= 4): r.difficulty = \"intermediate\"; break;\n                case (r.value.difficulty <= 7): r.difficulty = \"advanced\";     break;\n            }\n        }\n        var html = \"\";\n        html += VIEW.format_add(r);\n        html += VIEW.format_thumb(r);\n        html += VIEW.format_info(r);\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-item\"\n        });\n    };\n\n    VIEW.format_add = function(r) {\n        var src = $(\".removevideo img\").prop(\"src\").replace(\"removevideo\", \"add\");\n        var html = HTML.emptytag(\"img\", {\n            \"src\": src,\n            \"title\": VIEW.str.addthisvideo\n        });\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-add\",\n            \"id\": \"id_add_video_\" + r.value.dialogID\n        });\n    };\n\n    VIEW.format_thumb = function(r) {\n        var duration = r.value.duration.replace(new RegExp(\"^00:\"), \"\");\n        var html = \"\";\n        html += HTML.starttag(\"div\", {\n            \"class\": \"thumb-frame\",\n            \"style\": \"background-image: url('\" + r.value.thumbnailURL + \"')\"\n        });\n        html += HTML.tag(\"div\", r.value.difficulty, {\n            \"class\": \"result-difficulty \" + r.difficulty\n        });\n        html += HTML.tag(\"div\", duration, {\n            \"class\": \"result-duration\"\n        });\n        html += HTML.endtag(\"div\");\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-thumb\",\n            \"data-url\": r.value.dialogURL,\n        });\n    };\n\n    VIEW.format_info = function(r) {\n        var html = \"\";\n        var src = $(\".removevideo img\").prop(\"src\")\n            .replace(\"removevideo\", \"i/info\")\n            .replace(\"mod_englishcentral\", \"core\");\n        var img = HTML.emptytag(\"img\", {\n            \"src\": src,\n            \"class\": \"icon\"\n        });\n        var title = r.value.title;\n        if (r.highlights.en_name) {\n            title = r.highlights.en_name[0];\n        }\n        html += HTML.tag(\"h2\", title + img, {\n            \"class\": \"result-title\"\n        });\n        html += VIEW.format_details(r);\n        return HTML.tag(\"div\", html, {\n            \"class\": \"result-info\"\n        });\n    };\n\n    VIEW.format_details = function(r) {\n        var html = \"\";\n        //html += VIEW.format_copyright(r.value.copyright);\n        html += VIEW.format_goalstopics(r.value.goals, r.value.topics, r.difficulty);\n        html += VIEW.format_description(r.value.description);\n        html += VIEW.format_transcript(r.highlights.transcript);\n        return HTML.tag(\"dl\", html, {\n            \"class\": \"result-details\"\n        });\n    };\n\n    VIEW.format_copyright = function(copyright) {\n        if (copyright && copyright.length) {\n            return VIEW.format_detail(\"copyright\", copyright);\n        }\n        return \"\";\n    };\n\n    VIEW.format_goalstopics = function(goals, topics, difficulty) {\n        var txt = [];\n        if (goals && goals.length) {\n            for (var i = 0; i < goals.length; i++) {\n                txt.push(goals[i].title);\n            }\n        }\n        if (topics && topics.length) {\n            for (var i = 0; i < topics.length; i++) {\n                txt.push(topics[i].name);\n            }\n        }\n        if (txt.length == 0) {\n            return \"\";\n        }\n        txt = txt.join(\", \");\n        txt += HTML.tag(\"span\", VIEW.str[difficulty], {\n            \"class\": \"result-level \" + difficulty\n        });\n        return VIEW.format_detail(\"topics\", txt);\n    };\n\n    VIEW.format_description = function(description) {\n        if (description && description.length) {\n            return VIEW.format_detail(\"description\", description);\n        }\n        return \"\";\n    };\n\n    VIEW.format_transcript = function(transcript) {\n        if (transcript && transcript.length) {\n            var dots = \"...\";\n            var slashes = new RegExp(\"//\", \"g\");\n            return VIEW.format_detail(\"transcript\", dots + transcript[0].replace(slashes, dots) + dots);\n        }\n        return \"\";\n    };\n\n    VIEW.format_detail = function(type, value) {\n        var html = \"\";\n        html += HTML.tag(\"dt\", VIEW.str[type], {\n            \"class\": \"result-label \" + type\n        });\n        html += HTML.tag(\"dd\", value, {\n            \"class\": \"result-value \" + type\n        });\n        return html;\n    };\n\n    VIEW.isNotNum = function(n) {\n        switch (typeof(n)) {\n            case \"number\": return false;\n            case \"string\": return (! n.match(new RegExp(\"^[0-9]+$\")));\n            default:       return true; // everything else is NOT a number\n        }\n    };\n\n    return VIEW;\n});\n"],"names":["define","$","JUI","LOG","STR","HTML","VIEW","get_strings","plugin","done","s","i","str","addthisvideo","advanced","beginner","confirmremovevideo","copyright","description","duration","error","goals","hideadvanced","intermediate","level","ok","search","showadvanced","topics","transcript","videosearch","videosearchhelp","videosearchprompt","init","opts","getoptions","Deferred","ajax","viewajaxurl","cmid","moodlesesskey","resolve","ECSDK","when","sdkmode","sdkurl","sdkversion","url","dataType","cache","window","click","evt","play_video","this","stopPropagation","preventDefault","sortable","ui","item","find","data","get_videoid_from_url","index","html","playercontainer","droppable","confirm","draggable","remove","searchcontainer","submit","clear_player_and_searchresults","list","RegExp","term","val","map","value","get","join","match","fetch_videos","search_videos","text","toggle","elm","ecsdk","setHandler","setOnProgressEventHandler","setOnModeEndHandler","debug","eventType","thumbframe","dialogID","length","sdktoken","replace","JSON","parse","toString","substr","dialog","addClass","href","location","indexOf","replaceWith","thumb","after","dialogId","get_videoid","completed","options","consumerkey","lang","sitelanguage","siteLanguage","autoStart","activityPanelEnabled","interstitialsEnabled","learnMode","speakMode","quizMode","width","w","outerWidth","offset","left","height","loadWidget","page","size","spacer","ids","set_search_params","searchpage","searchsize","siteanguage","fetchurl","accept1","authorization","dialogs","info","count","results","highlights","en_name","title","en_topic","name","en_description","push","score","format_results","searchterm","difficulty","searchurl","isNotNum","searchlevel","parseInt","pagingbar","videoids","get_videoids","id","format_result","get_string","formatnumber","prepend","tag","v","dialogURL","thumbnailURL","add_video","siblings","open_window","closest","prop","videoinfourl","get_videoid_from_id","each","Math","min","innerWidth","h","innerHeight","x","screenX","outerHeight","screenY","win","open","targetwindow","focus","lastpage","ceil","p_min","max","p_max","firstpage","p","n","separator","regexp","insertBefore","fadeTo","slideUp","r","format_add","format_thumb","format_info","src","emptytag","starttag","endtag","img","format_details","format_goalstopics","format_description","format_transcript","format_copyright","format_detail","txt","slashes","type"],"mappings":"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"}