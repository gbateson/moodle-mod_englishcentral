{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * load the EnglishCentral player\n *\n * @module      mod_englishcentral/form\n * @category    output\n * @copyright   Gordon Bateson\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       2.9\n */\ndefine([\"jquery\"], function($) {\n    /** @alias module:mod_englishcentral/form */\n    var FORM = {};\n\n    FORM.init = function() {\n\n        $(\"#id_studygoal\").prop(\"type\", \"hidden\");\n        $(\"#id_studygoal\").after('<span id=\"id_studygoaltext\"></span>');\n\n        $(\"#id_watchgoal, #id_learngoal, #id_speakgoal, #id_chatgoal\").change(function(){\n            var watch = $(\"#id_watchgoal\").val();\n            var learn = $(\"#id_learngoal\").val();\n            var speak = $(\"#id_speakgoal\").val();\n            var chat = $(\"#id_chatgoal\").val();\n            var mins = (isNaN(watch) ? 0 : parseInt(watch) * 6) // 6 mins per video watched\n                     + (isNaN(learn) ? 0 : parseInt(learn))     // 1 min per word learned\n                     + (isNaN(speak) ? 0 : parseInt(speak))     // 1 min per word spoken\n                     + (isNaN(chat) ? 0 : parseInt(chat) * 4);  // 4 mins per chat question\n            $(\"#id_studygoal\").val(mins);\n            $(\"#id_studygoaltext\").text(mins);\n        });\n\n        $(\"#id_watchgoal\").trigger(\"change\");\n\n        var lastgoal = null;\n        var goaltypes = new Array('watch', 'learn', 'speak', 'chat');\n        for (var i = 0; i < goaltypes.length; i++) {\n            var type = goaltypes[i];\n            var nextgoal = document.querySelector(\"#fgroup_id_\" + type + \"goalgroup\");\n            if (nextgoal) {\n                if (lastgoal) {\n                    $(lastgoal).after('<div class=\"mathsymbol\"> + </div>');\n                }\n                lastgoal = nextgoal;\n            }\n        }\n        if (lastgoal) {\n            $(lastgoal).after('<div class=\"mathsymbol\"> = </div>');\n        }\n\n        // Fix layout on Boost-based themes.\n        // We want the goals to appear as boxes:\n        // [Watch] + [Learn] + [Speak] + [Chat] = [Study goals]\n        var goals = document.querySelector(\"#id_goals\");\n        if (goals) {\n            if (goals.querySelector(\".form-group\") === null) {\n                var s = '[id^=fgroup_id][id$=group]';\n                goals.querySelectorAll(s).forEach(function(fgroup){\n                    if (fgroup.id.indexOf(\"_error_\") > 0) {\n                        return;\n                    }\n                    fgroup.classList.add(\"d-inline-block\", \"rounded\", \"px-2\", \"pb-2\", \"mx-0\");\n                    // The \"form-group\" selector seems to have been deprecated\n                    // and replaced by \"mb-3\" in the \"Classic\" and \"Boost\" themes.\n                    fgroup.querySelectorAll(\".mb-3.fitem\").forEach(function(fitem){\n                        fitem.classList.remove(\"mb-3\");\n                        fitem.classList.add(\"d-inline-block\");\n                    });\n                });\n            } else {\n                goals.querySelectorAll(\".form-group\").forEach(function(fgroup){\n                    fgroup.classList.remove(\"form-group\");\n                    fgroup.classList.add(\"d-inline-block\");\n                });\n                goals.querySelectorAll(\".row\").forEach(function(row){\n                    row.classList.remove(\"row\");\n                    row.classList.add(\"rounded\", \"px-2\", \"mb-2\", \"align-top\");\n                    row.style.minHeight = \"80px\";\n                });\n            }\n\n            // Remove all the sexy, flexy selectors.\n            var selectors = [\n                \"col-md-3\", \"col-md-9\", \"d-flex\",\n                \"align-items-start\", \"align-self-start\",\n            ];\n            selectors.forEach(function(s){\n                goals.querySelectorAll(\".\" + s).forEach(function(elm){\n                    elm.classList.remove(s);\n                });\n            });\n\n            // Embolden all the label text\n            goals.querySelectorAll(\".col-form-label\").forEach(function(elm){\n                for (var i=0; i < elm.children.length; i++) {\n                    var child = elm.children[i];\n                    child.classList.add(\"d-inline-block\");\n                    if (child.matches(\"[id^='fgroup_'][id$='_label']\")) {\n                        child.classList.add(\"font-weight-bold\");\n                    }\n                }\n            });\n        }\n    };\n\n    return FORM;\n});"],"names":["define","$","FORM","prop","after","change","watch","val","learn","speak","chat","mins","isNaN","parseInt","text","trigger","lastgoal","goaltypes","Array","i","length","type","nextgoal","document","querySelector","goals","querySelectorAll","forEach","fgroup","id","indexOf","classList","add","fitem","remove","row","style","minHeight","s","elm","children","child","matches"],"mappings":";;;;;;;;;AAyBAA,iCAAO,CAAC,WAAW,SAASC,OAEpBC,KAAO,CAEXA,KAAY,WAERD,EAAE,iBAAiBE,KAAK,OAAQ,UAChCF,EAAE,iBAAiBG,MAAM,uCAEzBH,EAAE,6DAA6DI,QAAO,eAC9DC,MAAQL,EAAE,iBAAiBM,MAC3BC,MAAQP,EAAE,iBAAiBM,MAC3BE,MAAQR,EAAE,iBAAiBM,MAC3BG,KAAOT,EAAE,gBAAgBM,MACzBI,MAAQC,MAAMN,OAAS,EAAsB,EAAlBO,SAASP,SAC5BM,MAAMJ,OAAS,EAAIK,SAASL,SAC5BI,MAAMH,OAAS,EAAII,SAASJ,SAC5BG,MAAMF,MAAQ,EAAqB,EAAjBG,SAASH,OACvCT,EAAE,iBAAiBM,IAAII,MACvBV,EAAE,qBAAqBa,KAAKH,SAGhCV,EAAE,iBAAiBc,QAAQ,kBAEvBC,SAAW,KACXC,UAAY,IAAIC,MAAM,QAAS,QAAS,QAAS,QAC5CC,EAAI,EAAGA,EAAIF,UAAUG,OAAQD,IAAK,KACnCE,KAAOJ,UAAUE,GACjBG,SAAWC,SAASC,cAAc,cAAgBH,KAAO,aACzDC,WACIN,UACAf,EAAEe,UAAUZ,MAAM,qCAEtBY,SAAWM,UAGfN,UACAf,EAAEe,UAAUZ,MAAM,yCAMlBqB,MAAQF,SAASC,cAAc,gBAC/BC,MAAO,IACoC,OAAvCA,MAAMD,cAAc,eAAyB,CAE7CC,MAAMC,iBADE,8BACkBC,SAAQ,SAASC,QACnCA,OAAOC,GAAGC,QAAQ,WAAa,IAGnCF,OAAOG,UAAUC,IAAI,iBAAkB,UAAW,OAAQ,OAAQ,QAGlEJ,OAAOF,iBAAiB,eAAeC,SAAQ,SAASM,OACpDA,MAAMF,UAAUG,OAAO,QACvBD,MAAMF,UAAUC,IAAI,8BAI5BP,MAAMC,iBAAiB,eAAeC,SAAQ,SAASC,QACnDA,OAAOG,UAAUG,OAAO,cACxBN,OAAOG,UAAUC,IAAI,qBAEzBP,MAAMC,iBAAiB,QAAQC,SAAQ,SAASQ,KAC5CA,IAAIJ,UAAUG,OAAO,OACrBC,IAAIJ,UAAUC,IAAI,UAAW,OAAQ,OAAQ,aAC7CG,IAAIC,MAAMC,UAAY,UAKd,CACZ,WAAY,WAAY,SACxB,oBAAqB,oBAEfV,SAAQ,SAASW,GACvBb,MAAMC,iBAAiB,IAAMY,GAAGX,SAAQ,SAASY,KAC7CA,IAAIR,UAAUG,OAAOI,SAK7Bb,MAAMC,iBAAiB,mBAAmBC,SAAQ,SAASY,SAClD,IAAIpB,EAAE,EAAGA,EAAIoB,IAAIC,SAASpB,OAAQD,IAAK,KACpCsB,MAAQF,IAAIC,SAASrB,GACzBsB,MAAMV,UAAUC,IAAI,kBAChBS,MAAMC,QAAQ,kCACdD,MAAMV,UAAUC,IAAI,kCAOjC9B"}